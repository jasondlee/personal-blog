<!DOCTYPE html>
<html>
<head>
    <title>Coming Up for Air : Writing Pluggable Java EE Applications, The Explanation</title>

    <script src="/assets/js/simple-jekyll-search.min.js" type="text/javascript"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3GQK1YDRQM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-3GQK1YDRQM');
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="me" href="https://mastodon.cloud/@jasondlee"/>

    <link rel="alternate" type="application/rss+xml" title="jasondl.ee RSS feed" href="/feed.xml">

    <link rel="stylesheet" href="/assets/css/main.css" />

    <!-- Web Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Cherry+Cream+Soda">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Philosopher">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css"/>

    <link rel="stylesheet" href="https://unpkg.com/primeflex@3.1.2/primeflex.css"/>
    <link rel="stylesheet" href="https://unpkg.com/primeflex/themes/saga-blue.css"/>
    <link rel="author" href="/images/profile-pic.jpg"/>
</head>
<body>
<div class="grid">
    <div class="col blogname">
        <span>
            <a href="https://jasondl.ee">Coming Up for Air</a>
        </span>
    </div>
</div>
<div class="grid main">
    <div class="col-9">
        <div id="content">
            <article class="post">
    <h1 class="title" style="border-bottom: solid 1px #47586d; margin-bottom: 0.25rem;">
        Writing Pluggable Java EE Applications, The Explanation
    </h1>
    Tuesday, July 10, 2012 | <span class="share-page" style="">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation&title=Writing Pluggable Java EE Applications, The Explanation" rel="nofollow" target="_blank" title="Share on LinkedIn">
      <i class="fa fa-linkedin-square"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Writing Pluggable Java EE Applications, The Explanation&url=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation&via=jasondlee&related=jasondlee" rel="nofollow" target="_blank" title="Share on Twitter">
      <i class="fa fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation" rel="nofollow" target="_blank" title="Share on Facebook">
      <i class="fa fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="https://www.reddit.com/submit?url=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
      <i class="fa fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Writing Pluggable Java EE Applications, The Explanation&amp;body=Writing Pluggable Java EE Applications, The Explanation https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation" title="Share via Email" >
      <i class="fa fa-envelope"></i>
  </a>
</span>

    <div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>I recently posted the slides and the source code from the presentation I gave at <a href="http://jaxconf.com/2012">JAXConf San Francisco</a>. While that&#8217;s helpful for those who were in my session, it&#8217;s probably less so for those who weren&#8217;t.  What I&#8217;ll do in this post, then, is discuss the slides and code in detail, skipping over the introductory slides, and getting right to the heart of the matter.</p>
</div>
<div class="paragraph">
<p>The <em>idea</em> of plugins is easy. The <em>how</em> is, often the hard part.  To provide the "how", I&#8217;ve broken the question into two parts: how do I get access to the plugins, and how do I write the plugins.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problem-1-classloading">Problem #1: ClassLoading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Perhaps the first question one should ask is, "How do I load the plugin data?" After all, if you can&#8217;t load the plugins, who cares if you can write them? There are many, many options, of course, but we&#8217;ll take a look at three, to keep things simple: repackaging, manual class loading, and OSGi.</p>
</div>
<div class="sect2">
<h3 id="repackaging">Repackaging</h3>
<div class="paragraph">
<p>Perhaps the simplest, safest approach is simply to repackage the application.  This is exactly what it sounds like: you take the original application archive, and .war, for example, and add the plugin jars. This avoids some of the potential problems we&#8217;ll see in other approaches, as well as pushing the heavy lifting on to your container.  You can do this through some sort of Ant- or Maven-based system, or a simple shell script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span style="color: #6e7781">#!/bin/bash</span>

<span style="color: #0550ae">DIST</span><span style="color: #0550ae">=</span><span style="color: #0550ae">$1</span>
<span style="color: #cf222e">if</span> <span style="color: #0550ae">[</span> <span style="color: #0a3069">"</span><span style="color: #0550ae">$DIST</span><span style="color: #0a3069">"</span> <span style="color: #0550ae">==</span> <span style="color: #0a3069">""</span> <span style="color: #0550ae">]</span> <span style="color: #24292f;background-color: #f6f8fa">;</span> <span style="color: #cf222e">then
    </span><span style="color: #953800">echo</span> <span style="color: #0a3069">"You must specify the distribution .war"</span>
    <span style="color: #953800">exit </span>1
<span style="color: #cf222e">fi
</span><span style="color: #0550ae">BASE</span><span style="color: #0550ae">=</span><span style="color: #0550ae">`</span><span style="color: #953800">echo</span> <span style="color: #0550ae">$DIST</span> | <span style="color: #953800">sed</span> <span style="color: #116329">-e</span> <span style="color: #0a3069">'s/\.war//'</span><span style="color: #0550ae">`</span>

<span style="color: #953800">rm</span> <span style="color: #116329">-rf</span> work
<span style="color: #953800">mkdir </span>work
<span style="color: #953800">cd </span>work

jar xf ../<span style="color: #0550ae">$DIST</span>
<span style="color: #953800">cp</span> ../plugins/<span style="color: #cf222e">*</span>jar WEB-INF/lib

jar cf ../<span style="color: #0550ae">$BASE</span><span style="color: #116329">-repackaged</span>.war <span style="color: #cf222e">*</span>

<span style="color: #953800">cd</span> ..
<span style="color: #953800">rm</span> <span style="color: #116329">-rf</span> work
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The upside to this is that you maintain access to all of the technologies provided by your container: EJB, JMS, etc.  The downside is that deployment/upgrade takes a bit more work, and means that if you forget to run this process, you&#8217;ve suddenly lost all of your plugins. Not a major thing, but certainly <em>a</em> thing. :)</p>
</div>
</div>
<div class="sect2">
<h3 id="manual-classloading">Manual ClassLoading</h3>
<div class="paragraph">
<p>From a technical perspective, this is my favorite approach, simply because of the pure hardcode geekiness of it.  In a nutshell, we read the bytecode from the jar file(s), and shove it into the ClassLoader.  Fraught with peril, sure, but fun nonetheless.</p>
</div>
<div class="paragraph">
<p>In the source tarball, you&#8217;ll find a project called <em>Plummer</em>.  Plummer, so called because it provides some of the <em>plumbing</em> for the plugin system. before we dive into what Plummer provides, we should note that the plugin approach we&#8217;ll look at is based very heavily on CDI, a new specification in Java EE 6. What we need to do in this part of plugin equation is to provide these plugin classes to the CDI runtime.  In Plummer, this happens in the PluginLoader class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">PluginLoader</span> <span style="color: #cf222e">implements</span> <span style="color: #953800">Extension</span> <span style="color: #0550ae">{</span>
    <span style="color: #cf222e">protected</span> <span style="color: #cf222e">static</span> <span style="color: #cf222e">final</span> <span style="color: #953800">String</span> <span style="color: #953800">SERVICES_NAME</span> <span style="color: #0550ae">=</span> <span style="color: #0a3069">"com.steeplesoft.plummer.finders"</span><span style="color: #0550ae">;</span>
    <span style="color: #cf222e">private</span> <span style="color: #cf222e">static</span> <span style="color: #cf222e">final</span> <span style="color: #953800">Logger</span> <span style="color: #24292f;background-color: #f6f8fa">logger</span> <span style="color: #0550ae">=</span> <span style="color: #953800">Logger</span><span style="color: #0550ae">.</span><span style="color: #116329">getLogger</span><span style="color: #0550ae">(</span><span style="color: #953800">PluginLoader</span><span style="color: #0550ae">.</span><span style="color: #116329">class</span><span style="color: #0550ae">.</span><span style="color: #116329">getName</span><span style="color: #0550ae">());</span>
    <span style="color: #cf222e">private</span> <span style="color: #cf222e">static</span> <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">PluginFinder</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">pluginFinders</span><span style="color: #0550ae">;</span>
    <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">Class</span><span style="color: #0550ae">&lt;?</span> <span style="color: #cf222e">extends</span> <span style="color: #953800">PluginFinder</span><span style="color: #0550ae">&gt;&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">pluginFinderClasses</span><span style="color: #0550ae">;</span>

    <span style="color: #cf222e">public</span> <span style="color: #cf222e">void</span> <span style="color: #8250df">beforeBeanDiscovery</span><span style="color: #0550ae">(</span><span style="color: #8250df">@Observes</span> <span style="color: #953800">BeforeBeanDiscovery</span> <span style="color: #24292f;background-color: #f6f8fa">bbd</span><span style="color: #0550ae">,</span> <span style="color: #953800">BeanManager</span> <span style="color: #24292f;background-color: #f6f8fa">beanManager</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">PluginFinder</span> <span style="color: #24292f;background-color: #f6f8fa">pluginFinder</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">getPluginFinders</span><span style="color: #0550ae">())</span> <span style="color: #0550ae">{</span>
            <span style="color: #cf222e">try</span> <span style="color: #0550ae">{</span>
                <span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">Class</span><span style="color: #0550ae">&lt;?&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">clazz</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">pluginFinder</span><span style="color: #0550ae">.</span><span style="color: #116329">getClasses</span><span style="color: #0550ae">())</span> <span style="color: #0550ae">{</span>
                    <span style="color: #cf222e">final</span> <span style="color: #953800">AnnotatedType</span><span style="color: #0550ae">&lt;?&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">annotatedType</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">beanManager</span><span style="color: #0550ae">.</span><span style="color: #116329">createAnnotatedType</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">clazz</span><span style="color: #0550ae">);</span>
                    <span style="color: #24292f;background-color: #f6f8fa">logger</span><span style="color: #0550ae">.</span><span style="color: #116329">log</span><span style="color: #0550ae">(</span><span style="color: #953800">Level</span><span style="color: #0550ae">.</span><span style="color: #116329">INFO</span><span style="color: #0550ae">,</span> <span style="color: #0a3069">"Adding AnnotatedType for {0}"</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">annotatedType</span><span style="color: #0550ae">.</span><span style="color: #116329">toString</span><span style="color: #0550ae">());</span>
                    <span style="color: #24292f;background-color: #f6f8fa">bbd</span><span style="color: #0550ae">.</span><span style="color: #116329">addAnnotatedType</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">annotatedType</span><span style="color: #0550ae">);</span>
                <span style="color: #0550ae">}</span>
            <span style="color: #0550ae">}</span> <span style="color: #cf222e">catch</span> <span style="color: #0550ae">(</span><span style="color: #953800">Exception</span> <span style="color: #24292f;background-color: #f6f8fa">ex</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
                <span style="color: #953800">Logger</span><span style="color: #0550ae">.</span><span style="color: #116329">getLogger</span><span style="color: #0550ae">(</span><span style="color: #953800">PluginLoader</span><span style="color: #0550ae">.</span><span style="color: #116329">class</span><span style="color: #0550ae">.</span><span style="color: #116329">getName</span><span style="color: #0550ae">()).</span><span style="color: #116329">log</span><span style="color: #0550ae">(</span><span style="color: #953800">Level</span><span style="color: #0550ae">.</span><span style="color: #116329">SEVERE</span><span style="color: #0550ae">,</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">ex</span><span style="color: #0550ae">);</span>
            <span style="color: #0550ae">}</span>
        <span style="color: #0550ae">}</span>
    <span style="color: #0550ae">}</span>
    <span style="color: #6e7781">// ...</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we see CDI show up for the first time.  What have here is a CDI portable extension (for more information, see the <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/extend.html">CDI RI (Weld) documentation</a>).  We also see another CDI concept that we&#8217;ll revisit in the next section, Events. Since we&#8217;re a portable extension, the class is loaded by the runtime very early in the process.  In this case, our <code>Extension</code> <em>observes</em> the <code>BeforeBeanDiscovery</code> event, as you can see in the aptly-named method. This method asks the system for a list of the <code>PluginFinder</code> instances configured in the system (I got a little over-excited and added in the ability to have more than one, <em>Just In Case</em>). It then asks each <code>PluginFinder</code> for a list of the Classes it found.  For each class, it creates an <code>AnnotatedType</code>, which it then adds to the <code>BeforeBeanDiscovery</code> class. When this method exits, the CDI runtime will, eventually, scan our plugin classes for CDI annotations, and, voila! our plugins are registered with the system.</p>
</div>
<div class="paragraph">
<p>The bytecode loading is handled, in this case, by <code>FilesystemPluginFinder</code>. This class iterates over a list of jar files found in, by default, <code>$HOME/.plugins</code>.  For each <code>.class</code> file in each jar, the bytes are read and the class is defined in the ContextClassLoader.  We&#8217;ll not show how that happens here, but I will say that it seems to work pretty well. I&#8217;ve not found any issues with it so far, but I also have not been able to drive it very hard yet.</p>
</div>
<div class="paragraph">
<p>When using this approach, it&#8217;s important to note some of its restrictions. Given <em>how</em> and <em>when</em> the classes are loaded, certain Java EE technologies are <strong>not</strong> available. Namely, this includes EJB, JMS, etc., as the related containers are unable to scan the classes for annotations.  I have not tested JPA support yet.  CDI seems to be completely and well supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="osgi">OSGi</h3>
<div class="paragraph">
<p>It seems that any discussion of plugins (or modules, if you will) would be incomplete without talking about OSGi.  As I started thinking about this topic, Web Application Bundles came to mind pretty quickly. I will admit that I am far from an OSGi expert, but it seems that WABs aren&#8217;t <em>quite</em> what we want. In fact, they seem to be designed to solve different issues. WABs and Plummer are not mutually exclusive, however. In fact, I have very young, incomplete code in Plummer to allow a system to deliver plugins as OSGi bundles.</p>
</div>
<div class="paragraph">
<p>Plummer assists in this by providing, in <code>plummer-api</code>, the <code>PluginActivator</code> class. This bundle activator runs, of course, when the bundle is started. You can look at the code for details, but it passes the <code>Bundle</code> to Plummer&#8217;s <code>PluginTracker</code>, which calls <code>Bundle.findEntries()</code> to find the class files in the bundle. The information is stored, and ultimately passed to the <code>PluginLoader</code> mentioned above.</p>
</div>
<div class="paragraph">
<p>In terms of drawbacks, this one has the most severe of the approaches we&#8217;ve discussed. In addition to having the same limitations (most likely) as the manual class loading approach, it has one even more significant one: it does not currently work. :) I think the theory/approach is sound, but I have not had the chance to finish and test the code to date. For those interested, you know what to do. :)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problem-2-application-design">Problem #2: Application Design</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we&#8217;ve answered any questions anyone would have&#8201;&#8212;&#8201;ever&#8201;&#8212;&#8201;about plugin loading, let&#8217;s spend some time on the more interesting part: how do I design the plugins.  I would like to note that it&#8217;s <em>probably</em> not possible to write a complete, generally useful plugin system that works across applications, problem domains. If someone were determined enough to prove me wrong and actually did just that, I&#8217;d be willing to be that it would be difficult to use, heavy, etc. If this person were truly determined, gifted, etc. to prove me wrong yet again, well&#8230;&#8203; good for him. :) For the rest of us (or, in this case, just me), Java EE makes this so easy that you really don&#8217;t need any extra frameworks.  Specifically, we&#8217;ll take a look at JSF, CDI, and JAX-RS.</p>
</div>
<div class="sect2">
<h3 id="view-extensibility">View Extensibility</h3>
<div class="paragraph">
<p>Let&#8217;s start by taking a look at view extensibility, as, after all, even if you have the greatest plugin system in the world, if it can&#8217;t affect the view, then it&#8217;s pretty much worthless.  To demonstrate this technique, we&#8217;re going to use JavaServer Faces, as it is the Java EE standard for web applications.  You may prefer another framework, such as Spring MVC, Wicket, or GWT, or you may even be using desktop technologies such as Swing, SWT, or JavaFX to build views for your Java EE application.  The technique here should work the same regardless of framework, more or less. You&#8217;ll just have to determine how to integrate into your technology of choice.</p>
</div>
<div class="paragraph">
<p>For a plugin to add content to the view, it will have to provide what we on the GlassFish Console team ended up calling <em>view fragments</em>.  These fragments are exactly what they sound like, small pieces of UI&#8230;&#8203;<em>widgets</em> that are added at specific points in the view. These fragments are categorized, by the plugin, into types, as defined by the consuming application. This means that the app might declare the types <em>tab</em>, <em>treeNode</em>, and <em>widget</em>. Aplugin, then, might add a <em>tab</em> to a configuration page, a <em>treeNode</em> to the navigation system, and a recent tweets <em>widget</em> to the sidebar.  As we&#8217;ll see, how complex or simple the categorization/differentiaton exposed by the application is is completly up to you as the application author/architect.</p>
</div>
<div class="paragraph">
<p>Having defined the terms, then, how might one implement this?  First off, let&#8217;s take a look at <code>ViewFragment.java</code> in the <code>plummer-api</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #8250df">@interface</span> <span style="color: #953800">ViewFragment</span> <span style="color: #0550ae">{</span>
    <span style="color: #953800">String</span> <span style="color: #8250df">type</span><span style="color: #0550ae">();</span>
    <span style="color: #953800">String</span> <span style="color: #8250df">parent</span><span style="color: #0550ae">()</span> <span style="color: #cf222e">default</span> <span style="color: #0a3069">""</span><span style="color: #0550ae">;</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This simple interface defines <code>type</code> and <code>parent</code> properties. A plugin author would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">SamplePlugin</span> <span style="color: #cf222e">implements</span> <span style="color: #953800">Plugin</span> <span style="color: #0550ae">{</span>
    <span style="color: #8250df">@ViewFragment</span><span style="color: #0550ae">(</span><span style="color: #0550ae">type:</span> <span style="color: #0a3069">"foo"</span><span style="color: #0550ae">)</span>
    <span style="color: #cf222e">public</span> <span style="color: #cf222e">static</span> <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">sample1</span> <span style="color: #0550ae">=</span> <span style="color: #0a3069">"sample1.xhtml"</span><span style="color: #0550ae">;</span>

    <span style="color: #8250df">@Override</span>
    <span style="color: #cf222e">public</span> <span style="color: #cf222e">int</span> <span style="color: #8250df">getPriority</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">return</span> <span style="color: #0550ae">500</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several things to note here. First, let&#8217;s look at the annotation.  Here, we are defining a <code>ViewFragment</code> of type <em>foo</em>. It is attached to a <code>public static final String</code>, whose value is <em>sample.xhtml</em>.  When the system processes this annotation, it will store the value <em>sample.xhtml</em> in a <code>Map</code>, keyed by the value <em>foo</em>. When the view asks for view fragments of type <em>foo</em>, this piece of markup will be included. That file, by the way, is a simple JSF 2 Facelets file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span style="color: #6e7781">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;</span>
<span style="color: #6e7781">&lt;!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span>
<span style="color: #116329">&lt;ui:fragment</span> <span style="color: #116329">xmlns=</span><span style="color: #0a3069">"http://www.w3.org/1999/xhtml"</span>
                <span style="color: #116329">xmlns:f=</span><span style="color: #0a3069">"http://java.sun.com/jsf/core"</span>
                <span style="color: #116329">xmlns:h=</span><span style="color: #0a3069">"http://java.sun.com/jsf/html"</span>
                <span style="color: #116329">xmlns:ui=</span><span style="color: #0a3069">"http://java.sun.com/jsf/facelets"</span><span style="color: #116329">&gt;</span>
    <span style="color: #116329">&lt;h1&gt;</span>Plugin Fragment<span style="color: #116329">&lt;/h1&gt;</span>
    This text comes from a fragment. Shiny!
<span style="color: #116329">&lt;/ui:fragment&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Very simple. The question that should come to mind now is, "How does the system find this annotation, and then how do I tell the system to insert this into my view?" The answer to the first half of that question is the <code>Plugin</code> interface. Those interested in the nitty gritty can read the code (<code>PluginService.java</code> in <code>plummer-kernel</code>), but for those not <em>that</em> curious, CDI again saves the day. In a nutshell, we ask CDI for all the beans that implement <code>Plugin</code>, scan them for fields annotated with <code>ViewFragment</code>, and store the metadata.  On the view side, we use the <code>pl:viewFragment</code> custom component that Plummer offers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span style="color: #116329">&lt;pl:viewFragment</span> <span style="color: #f6f8fa;background-color: #82071e">type:</span> <span style="color: #f6f8fa;background-color: #82071e">"foo"</span><span style="color: #116329">/&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The system does the rest.  What you put in your view fragments is completely up to you.  We&#8217;ve put everything from simple markup to `h:form`s with no known issues. One note with regard to resources: since the resources are stored in JARs and not in the application&#8217;s document root, you will need to use JSF 2&#8217;s resource mechanism to reference images, javascript, CSS, etc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span style="color: #116329">&lt;h:graphicImage</span> <span style="color: #116329">value=</span><span style="color: #0a3069">"#{resource['myImage.JPG']}"</span> <span style="color: #116329">height=</span><span style="color: #0a3069">"200"</span>
    <span style="color: #f6f8fa;background-color: #82071e">title:</span> <span style="color: #f6f8fa;background-color: #82071e">"Here's</span> <span style="color: #f6f8fa;background-color: #82071e">a</span> <span style="color: #f6f8fa;background-color: #82071e">picture</span> <span style="color: #f6f8fa;background-color: #82071e">of</span> <span style="color: #f6f8fa;background-color: #82071e">something</span> <span style="color: #f6f8fa;background-color: #82071e">really</span> <span style="color: #f6f8fa;background-color: #82071e">cool!"</span><span style="color: #116329">/&gt;</span>"
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see a complete example of this in <code>plummer-sample2</code>.</p>
</div>
<div class="paragraph">
<p>One final note before we move on: The code in Plummer is <em>mostly</em> standards-compliant, but some Mojarra-specific classes needed to be used get access to the <code>FaceletFactory</code> needed to insert the view fragments into the component tree. MyFaces users can still use Plummer, but someone will need to implement the MyFaces-specific code to reproduce this functionality. It would be great if the spec could expose this kind of functionality, but that would require someone to file a request and then, preferably, submit the spec prose and implementation code to make that happen, and I just haven&#8217;t had the time. ;)</p>
</div>
</div>
<div class="sect2">
<h3 id="application-extensibility">Application Extensibility</h3>
<div class="paragraph">
<p>The real work, of course, is done at lower levels. Here we&#8217;ll see just how simple Java EE makes things.  Specifically, we&#8217;ll look at two parts of CDI, events, and what we&#8217;ll simply refer to as programmatic bean lookup.</p>
</div>
<div class="paragraph">
<p>CDI events is, conceptually, just a simple pub/sub system. One part of the system fires, or publishes, events, and another observes (subscribes). This makes it very easy to loosely couple parts of the system: the core of your application need not worry about what, if anything handles, the event. It also easily allows multiple recipients to respond to the event fired. Again, the system doesn&#8217;t care. In Ron Popeil style, you just <a href="http://www.youtube.com/watch?v=tLq27iOW0R0">"set it and forget it"</a>.</p>
</div>
<div class="paragraph">
<p>So what does this look like in practice?  To demonstrate that in a meaningful way, we need a sample application, so we&#8217;ll write a <em>very</em> simple blogging system. If you&#8217;ve ever interacted with a blog, either as an author or a reader, you&#8217;ve likely seen the option by which a user can subscribe and get notifications of new posts. Let&#8217;s implement that.  First up, we&#8217;ll need a way to create blog entries.  You can find this <code>BlogBean.java</code> in the webapp, but here are the interesting parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span style="color: #6e7781">// ...</span>
<span style="color: #8250df">@Inject</span>
<span style="color: #cf222e">private</span> <span style="color: #953800">Event</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">BlogPostedEvent</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">blogPostedEvents</span><span style="color: #0550ae">;</span>

<span style="color: #cf222e">public</span> <span style="color: #953800">String</span> <span style="color: #8250df">addEntry</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
    <span style="color: #24292f;background-color: #f6f8fa">entries</span><span style="color: #0550ae">.</span><span style="color: #116329">add</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">entry</span><span style="color: #0550ae">);</span>
    <span style="color: #24292f;background-color: #f6f8fa">blogPostedEvents</span><span style="color: #0550ae">.</span><span style="color: #116329">fire</span><span style="color: #0550ae">(</span><span style="color: #cf222e">new</span> <span style="color: #953800">BlogPostedEvent</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">entry</span><span style="color: #0550ae">));</span>
    <span style="color: #24292f;background-color: #f6f8fa">entry</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">;</span>
    <span style="color: #cf222e">return</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">;</span>
<span style="color: #0550ae">}</span>
<span style="color: #6e7781">// ...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the sake of brevity here (too late, right?), you can find the view in <code>examples/webapp/src/main/webapp/blog.xhtml</code>.  First, notice the <code>@Inject</code>. Here, we&#8217;re asking CDI to inject an <code>Event</code> that takes a <code>BlogPostEvent</code> payload. We use this in <code>addEntry()</code>, when we call <code>blogPostedEvents.fire(new BlogPostedEvent(entry))</code>. The code, simple as it is, should be pretty self-explanatory: we&#8217;re firing an event of type <code>BlogPostedEvent</code>, which looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">BlogPostedEvent</span> <span style="color: #0550ae">{</span>
    <span style="color: #cf222e">private</span> <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">blogEntry</span><span style="color: #0550ae">;</span>

    <span style="color: #cf222e">public</span> <span style="color: #8250df">BlogPostedEvent</span><span style="color: #0550ae">(</span><span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">blogEntry</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">this</span><span style="color: #0550ae">.</span><span style="color: #116329">blogEntry</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">blogEntry</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>

    <span style="color: #cf222e">public</span> <span style="color: #953800">String</span> <span style="color: #8250df">getBlogEntry</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">blogEntry</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, our payload is very simple. In a real world, this could be much more complex if your application&#8217;s needs warrant. Responding to this event is just as simple as firing it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">void</span> <span style="color: #8250df">sendEmail</span><span style="color: #0550ae">(</span><span style="color: #8250df">@Observes</span> <span style="color: #953800">BlogPostedEvent</span> <span style="color: #24292f;background-color: #f6f8fa">event</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
    <span style="color: #24292f;background-color: #f6f8fa">emailService</span><span style="color: #0550ae">.</span><span style="color: #116329">sendEmail</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">event</span><span style="color: #0550ae">.</span><span style="color: #116329">getBlogEntry</span><span style="color: #0550ae">());</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s really all there is to it.  By using CDI events, we are able to <em>push</em> data into our plugins in a loosely coupled manner.  Again, in a real world application, the data push and the processing required to handle will likely be more complex, but the means of pushing it will not be. CDI for the win!</p>
</div>
<div class="paragraph">
<p>Perhaps you need to allow a plugin to process data in the system. For example, in our system we want allow plugins to translate the blog entry into another language. To do so, we first need to define the interface by which the plugin will be called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">interface</span> <span style="color: #953800">BlogEntryProcessor</span> <span style="color: #cf222e">extends</span> <span style="color: #953800">Serializable</span> <span style="color: #0550ae">{</span>
    <span style="color: #953800">String</span> <span style="color: #8250df">getName</span><span style="color: #0550ae">();</span>
    <span style="color: #953800">String</span> <span style="color: #8250df">process</span><span style="color: #0550ae">(</span><span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">);</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>From our blogging system, we can get a list of all of the <code>BlogEntryProcessor</code> instances, if any, with this CDI injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span style="color: #8250df">@Inject</span> <span style="color: #8250df">@Translator</span>
<span style="color: #953800">Instance</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">BlogEntryProcessor</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">translators</span><span style="color: #0550ae">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives us an <code>Instance</code> instance that contains any <code>BlogEntryProcessor`s defined in the system. We&#8217;ll come back to `@Translator</code> in a bit.  Next, we can provide a way for the user to pick a language with this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span style="color: #116329">&lt;h:form&gt;</span>
    <span style="color: #116329">&lt;h:selectOneMenu</span> <span style="color: #116329">value=</span><span style="color: #0a3069">"#{blogBean.translator}"</span> <span style="color: #116329">converter=</span><span style="color: #0a3069">"#{translatorConvertor}"</span><span style="color: #116329">&gt;</span>
        <span style="color: #116329">&lt;f:ajax</span> <span style="color: #116329">render=</span><span style="color: #0a3069">":entries"</span> <span style="color: #116329">event=</span><span style="color: #0a3069">"change"</span> <span style="color: #116329">execute=</span><span style="color: #0a3069">"@form"</span><span style="color: #116329">/&gt;</span>
        <span style="color: #116329">&lt;f:selectItems</span> <span style="color: #116329">value=</span><span style="color: #0a3069">"#{blogBean.translators}"</span> <span style="color: #116329">var=</span><span style="color: #0a3069">"t"</span> <span style="color: #116329">itemLabel=</span><span style="color: #0a3069">"#{t.name}"</span> <span style="color: #116329">/&gt;</span>
    <span style="color: #116329">&lt;/h:selectOneMenu&gt;</span>
<span style="color: #116329">&lt;/h:form&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">BlogEntryProcessor</span><span style="color: #0550ae">&gt;</span> <span style="color: #8250df">getTranslators</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
    <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">BlogEntryProcessor</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">list</span> <span style="color: #0550ae">=</span> <span style="color: #cf222e">new</span> <span style="color: #953800">ArrayList</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">BlogEntryProcessor</span><span style="color: #0550ae">&gt;();</span>
    <span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">BlogEntryProcessor</span> <span style="color: #24292f;background-color: #f6f8fa">t</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">translators</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #24292f;background-color: #f6f8fa">list</span><span style="color: #0550ae">.</span><span style="color: #116329">add</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">t</span><span style="color: #0550ae">);</span>
    <span style="color: #0550ae">}</span>
    <span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">list</span><span style="color: #0550ae">;</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This lets us change the language, but how do we get a default? Let&#8217;s define a <code>Qualifier</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span style="color: #8250df">@Qualifier</span>
<span style="color: #8250df">@Retention</span><span style="color: #0550ae">(</span><span style="color: #953800">RetentionPolicy</span><span style="color: #0550ae">.</span><span style="color: #116329">RUNTIME</span><span style="color: #0550ae">)</span>
<span style="color: #8250df">@Target</span><span style="color: #0550ae">({</span><span style="color: #953800">ElementType</span><span style="color: #0550ae">.</span><span style="color: #116329">TYPE</span><span style="color: #0550ae">,</span> <span style="color: #953800">ElementType</span><span style="color: #0550ae">.</span><span style="color: #116329">METHOD</span><span style="color: #0550ae">,</span> <span style="color: #953800">ElementType</span><span style="color: #0550ae">.</span><span style="color: #116329">FIELD</span><span style="color: #0550ae">,</span> <span style="color: #953800">ElementType</span><span style="color: #0550ae">.</span><span style="color: #116329">PARAMETER</span><span style="color: #0550ae">})</span>
<span style="color: #cf222e">public</span> <span style="color: #8250df">@interface</span> <span style="color: #953800">English</span> <span style="color: #0550ae">{</span> <span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This simple class lets us differentiate at injection time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span style="color: #8250df">@Inject</span>
<span style="color: #8250df">@English</span>
<span style="color: #cf222e">private</span> <span style="color: #953800">BlogEntryProcessor</span> <span style="color: #24292f;background-color: #f6f8fa">translator</span><span style="color: #0550ae">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of injecting <code>Instance&lt;BlogEntryProcessor&gt;</code>, we&#8217;re injecting a single..um&#8230;&#8203;instance. Since there might be more than <code>BlogEntryProcessor</code> on the system, we have to <em>qualify</em> which one we mean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span style="color: #8250df">@English</span>
<span style="color: #8250df">@Singleton</span>
<span style="color: #8250df">@Translator</span>
<span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">EnglishTranslator</span> <span style="color: #cf222e">implements</span> <span style="color: #953800">BlogEntryProcessor</span> <span style="color: #0550ae">{</span>
    <span style="color: #6e7781">// ...</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>EnglishTranslator</code> <code>is-a</code> <code>BlogEntryProcessor</code>, and it has been marked as <code>@English</code>, which means this instance, which is also a singleton, will satisfy the injection above.  We could have annotated this with <code>@Default</code>, both here and at the injection point, but the creation of a custom <code>@Qualifier</code> is a good exercise. :)</p>
</div>
<div class="paragraph">
<p>But what&#8217;s up with that <code>@Translator</code>? That&#8217;s another <code>@Qualifier</code>, which must be applied to any <code>BlogEntryProcessor</code> that is intended to act as a translator (and which we document clearly in our system documentation, right? ;).  Why is that important? In a simple system, we wouldn&#8217;t need that, but we&#8217;re going to intentionally muddy things a bit and introduce a different type of <code>BlogEntryProcessor</code>, one which allows for tags.</p>
</div>
<div class="paragraph">
<p>One common type of plugin in systems like Wordpress allows a user to wrap certain text in a tag. This entry, for example, uses the <code>code</code> tag to get syntax highlighting. In our system, we&#8217;ll implement a tag that creates links to Google Maps. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>Disneyland can be found at [map]1313 North Harbor Boulevard, Anaheim, CA[/map].
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>How is this implemented? Just like the translators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span style="color: #8250df">@Tag</span>
<span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">GoogleMapsProcessor</span> <span style="color: #cf222e">implements</span> <span style="color: #953800">BlogEntryProcessor</span> <span style="color: #0550ae">{</span>

    <span style="color: #8250df">@Override</span>
    <span style="color: #cf222e">public</span> <span style="color: #953800">String</span> <span style="color: #8250df">getName</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">return</span> <span style="color: #0a3069">"Google Maps Processor"</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>

    <span style="color: #8250df">@Override</span>
    <span style="color: #cf222e">public</span> <span style="color: #953800">String</span> <span style="color: #8250df">process</span><span style="color: #0550ae">(</span><span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #953800">Pattern</span> <span style="color: #24292f;background-color: #f6f8fa">pattern</span> <span style="color: #0550ae">=</span> <span style="color: #953800">Pattern</span><span style="color: #0550ae">.</span><span style="color: #116329">compile</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"\\[map\\](.*?)\\[\\/map\\]"</span><span style="color: #0550ae">);</span>
        <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">replaceStr</span> <span style="color: #0550ae">=</span> <span style="color: #0a3069">"&lt;a href=\\\"https://maps.google.com/maps?q=$1\\\"&gt;$1&lt;/a&gt;"</span><span style="color: #0550ae">;</span>

        <span style="color: #953800">Matcher</span> <span style="color: #24292f;background-color: #f6f8fa">matcher</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">pattern</span><span style="color: #0550ae">.</span><span style="color: #116329">matcher</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">);</span>
        <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">result</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">matcher</span><span style="color: #0550ae">.</span><span style="color: #116329">replaceAll</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">replaceStr</span><span style="color: #0550ae">);</span>
        <span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">result</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This looks <em>just</em> like the translators, right? The only difference is the <code>@Tag</code> qualifier, whose source you can see in the bundle.  In <code>BlogBean</code>, we access it <em>and</em> the translators in <code>getEntries()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span style="color: #8250df">@Inject</span>
<span style="color: #8250df">@Tag</span>
<span style="color: #953800">Instance</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">BlogEntryProcessor</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">tags</span><span style="color: #0550ae">;</span>

<span style="color: #cf222e">public</span> <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">String</span><span style="color: #0550ae">&gt;</span> <span style="color: #8250df">getEntries</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
    <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">String</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">list</span> <span style="color: #0550ae">=</span> <span style="color: #cf222e">new</span> <span style="color: #953800">ArrayList</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">String</span><span style="color: #0550ae">&gt;();</span>
    <span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">text</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">entries</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">BlogEntryProcessor</span> <span style="color: #24292f;background-color: #f6f8fa">tag</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">tags</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
            <span style="color: #24292f;background-color: #f6f8fa">text</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">tag</span><span style="color: #0550ae">.</span><span style="color: #116329">process</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">);</span>
        <span style="color: #0550ae">}</span>
        <span style="color: #24292f;background-color: #f6f8fa">text</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">translator</span><span style="color: #0550ae">.</span><span style="color: #116329">process</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">);</span>
        <span style="color: #24292f;background-color: #f6f8fa">list</span><span style="color: #0550ae">.</span><span style="color: #116329">add</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">);</span>
    <span style="color: #0550ae">}</span>
    <span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">list</span><span style="color: #0550ae">;</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can build and deploy the system to see this in action.   Very simple, but very effective.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-resources">REST Resources</h3>
<div class="paragraph">
<p>We&#8217;ve seen how to expose functionality to plugins loaded in the system, but what if we want to allow these plugins to expose this functionality to external clients, say, via REST? Again, Java EE makes this incredibly simple, using two specs in concert, CDI and JAX-RS.</p>
</div>
<div class="paragraph">
<p>One of the ways one might configure a JAX-RS application is to provide a custom <code>Application</code> class, one which extends <code>javax.ws.rs.core.Application</code>. Plummer provides such an <code>Application</code>, so all Plummer users need do is configure it in the web application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span style="color: #116329">&lt;servlet&gt;</span>
    <span style="color: #116329">&lt;servlet-name&gt;</span>Jersey Web Application<span style="color: #116329">&lt;/servlet-name&gt;</span>
    <span style="color: #116329">&lt;servlet-class&gt;</span>org.glassfish.jersey.servlet.ServletContainer<span style="color: #116329">&lt;/servlet-class&gt;</span>
    <span style="color: #116329">&lt;init-param&gt;</span>
        <span style="color: #116329">&lt;param-name&gt;</span>javax.ws.rs.Application<span style="color: #116329">&lt;/param-name&gt;</span>
        <span style="color: #116329">&lt;param-value&gt;</span>com.steeplesoft.plummer.kernel.rest.RestApplication<span style="color: #116329">&lt;/param-value&gt;</span>
    <span style="color: #116329">&lt;/init-param&gt;</span>
<span style="color: #116329">&lt;/servlet&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Oddly, note that the <code>Application</code> class is standardized, but the REST servlet is not (unlike, for example, JSF&#8217;s <code>FacesServlet</code>), so if you&#8217;re not using <a href="http://jersey.java.net">Jersey</a> like we are here, then you&#8217;ll need to use the <code>Servlet</code> appropriate for your JAX-RS implementation.</p>
</div>
<div class="paragraph">
<p>So how does <code>RestApplication</code> work? It uses CDI, but since it&#8217;s not handled by the CDI runtime, we can&#8217;t rely on injection.  Instead, we&#8217;ll perform a manual look up of the <code>BeanManager</code>, a class provided by CDI&#8217;s excellent portable extension mechanism.  We then query the <code>BeanManager</code> for our desired classes. But how do we identify our REST resources?  Remember the <code>Plugin</code> marker interface? Plummer defines another marker, <code>RestResource</code>, to mark the JAX-RS resources we want to load, which are typical JAX-RS resources with the exception of this extra interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span style="color: #8250df">@Path</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"myurl"</span><span style="color: #0550ae">)</span>
<span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">PluginRestResource</span> <span style="color: #cf222e">implements</span> <span style="color: #953800">RestResource</span> <span style="color: #0550ae">{</span>
    <span style="color: #8250df">@GET</span>
    <span style="color: #cf222e">public</span> <span style="color: #953800">String</span> <span style="color: #8250df">test</span><span style="color: #0550ae">(</span><span style="color: #8250df">@QueryParam</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"text"</span><span style="color: #0550ae">)</span> <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">return</span> <span style="color: #0a3069">"You sent "</span> <span style="color: #0550ae">+</span> <span style="color: #24292f;background-color: #f6f8fa">text</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the REST application is initialized, this class is loaded and exposed at <code>/myurl</code> as you would expect.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many, many plugin systems available for Java applications.  It might be that one of these systems, modeled after or borrowed from, for example, <a href="http://hudson-ci.org">Hudson</a> or others, is the best choice for your application.  I think that chances are good, though, that you need not resort to such a relatively complex system. The Java EE platform provides a rich set of APIs that will allow you to implement an domain-specific plugin system very simply, and with the introduction of another external dependency.</p>
</div>
</div>
</div>
    </div>
    <footer>
        <div class="grid">
            <div class="col tags">
                
                <span class="title">tags: </span>
                
                <a href="/tag/cdi/">CDI</a>
                <!--                <a href="https://jasondl.ee/tags/CDI.html">CDI</a>-->
                
                <a href="/tag/java-ee/">Java EE</a>
                <!--                <a href="https://jasondl.ee/tags/Java EE.html">Java EE</a>-->
                
                <a href="/tag/jsf/">JSF</a>
                <!--                <a href="https://jasondl.ee/tags/JSF.html">JSF</a>-->
                
                <a href="/tag/rest/">REST</a>
                <!--                <a href="https://jasondl.ee/tags/REST.html">REST</a>-->
                
                
            </div>
            <div class="col"><span class="share-page" style="">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation&title=Writing Pluggable Java EE Applications, The Explanation" rel="nofollow" target="_blank" title="Share on LinkedIn">
      <i class="fa fa-linkedin-square"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Writing Pluggable Java EE Applications, The Explanation&url=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation&via=jasondlee&related=jasondlee" rel="nofollow" target="_blank" title="Share on Twitter">
      <i class="fa fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation" rel="nofollow" target="_blank" title="Share on Facebook">
      <i class="fa fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="https://www.reddit.com/submit?url=https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
      <i class="fa fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Writing Pluggable Java EE Applications, The Explanation&amp;body=Writing Pluggable Java EE Applications, The Explanation https://jasondl.ee/2012/writing-pluggable-java-ee-applications-the-explanation" title="Share via Email" >
      <i class="fa fa-envelope"></i>
  </a>
</span>
</div>
        </div>
    </footer>
</article>

        </div>
    </div>
    <div class="col-3 widget">
        <div>
            <h3>Search</h3>
            <!-- HTML elements for search -->
            <input type="text" id="search-input" placeholder="Search blog posts.." style="width: 98%"/>
            <ul id="results-container"></ul>

            <script>
                var sjs = SimpleJekyllSearch({
                    searchInput: document.getElementById('search-input'),
                    resultsContainer: document.getElementById('results-container'),
                    json: '/search.json',
                    limit: 50
                })
            </script>
        </div>
        <div>
            <h3>Quotes</h3>
            <p id="quote">Sample quote</p>
            <p id="source">Quote source</p>
        </div>
        <div>
            <h3>About</h3>
            <p><img src="/images/profile-pic.jpg" style="float:right; object-fit: scale-down; padding-bottom: 1em;"/>My name is Jason Lee. I am a software developer living in the middle of Oklahoma. Ive been a professional developer since 1997,
using a variety of languages, including Java, Javascript, PHP, Python, Delphi, and even a bit of C#. I currently work for Red Hat
on the WildFly/EAP team, where, among other things, I maintain integrations for some MicroProfile specs, OpenTelemetry, Micrometer,
Jakarta Faces, and Bean Validation. (Full resume <a href="resume">here</a>.
LinkedIn <a href="https://www.linkedin.com/in/jasondlee">profile</a>)</p>

<p>I am the president of the Oklahoma City JUG, and an occasional speaker at the JUG and a variety of technical conferences.</p>

<p>On the personal side, Im active in my church, and enjoy bass guitar, running, fishing, and a variety of martial arts. Im also
married to a beautiful woman, and have two boys, who, thankfully, look like their mother.</p>

        </div>
        <div>
            <h3>My Links</h3>
            <ul>
                
                <li>
                    <a href="/presentations" title="Presentations">
                        Presentations
                    </a>
                </li>
                
                <li>
                    <a href="/assets/resume.pdf" title="Resume/CV">
                        Resume/CV
                    </a>
                </li>
                
                <li>
                    <a href="https://linkedin.com/in/jasondlee" title="LinkedIn">
                        LinkedIn
                    </a>
                </li>
                
                <li>
                    <a href="https://twitter.com/jasondlee" title="Twitter">
                        Twitter
                    </a>
                </li>
                
                <li>
                    <a href="https://mastodon.cloud/@jasondlee" title="Mastodon">
                        Mastodon
                    </a>
                </li>
                
                <li>
                    <a href="/tag" title="Tags">
                        Tags
                    </a>
                </li>
                
            </ul>

        </div>
        <div>
            <h3>Publications</h3>
            <ul>
                <li>
                    <div class="grid">
                        <div class="col-8" style="text-weight: bold; font-size: large">
                            <div>Java 9 Programming Blueprints:</div>
                            <div>
                                <a title="My Java 9 book at Amazon" href="https://amzn.to/2FD2XAo" style="padding-left: 10px">Amazon</a>
                            </div>
                            <div>
                                <a title="My Java 9 book at Packt"
                                   href="https://www.packtpub.com/application-development/java-9-programming-blueprints"
                                   style="padding-left: 10px">Packt</a>
                            </div>
                        </div>
                            <div class="col-4">
                                <a href="https://amzn.to/2FD2XAo"><img src="/images/2017/j9pb.png" width="100"/></a>
                            </div>
                    </div>
                </li>
                
                <li>
                    <a href="https://jaxenter.com/tips-for-writing-pluggable-java-ee-applications-105281.html" title="This article discusses ways to use Java EE specs to implement a simple, yet powerful plugin system with a minimum of thrid party libraries.">
                        Tips for Writing Pluggable Java EE Applications
                    </a>
                </li>
                
                <li>
                    <a href="http://www.oracle.com/technetwork/articles/javaee/jsf-templating-137822.html" title="An article Ken Paulsen and I wrote detailing easy JSF component creation">
                        JSFTemplating and Woodstock: Component Authoring Made Easy
                    </a>
                </li>
                
                <li>
                    <a href="http://jsfcentral.com/articles/lee-03-09.html" title="Jason Lee in depth: Mojarra and Scales">
                        Jason Lee in depth: Mojarra and Scales
                    </a>
                </li>
                
                <li>
                    <a href="https://web.archive.org/web/20090301060746/http://www.theserverside.com/news/thread.tss?thread_id=49343" title="My JavaOne 2008 Wrap Up">
                        Jason Lee: Postmortem for JavaOne 2008
                    </a>
                </li>
                
                <li>
                    <a href="https://web.archive.org/web/20130621192312/https://blogs.oracle.com/stories/entry/international_environmental" title="The GlassFish Adoption Story from my time at IEC">
                        International Environmental: A Cooling Company Which Prefers Hot Software
                    </a>
                </li>
                
                <li>
                    <a href="http://www.jsfcentral.com/articles/trenches_7.html" title="This details the project that spawned a couple of the Mojarra Scales components">
                        IEC donates custom JSF component to Mojarra Scales
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
<div class="footer">
    <div>
        <p>&#169; Copyright Jason Lee, 2005-2023. All rights reserved.</p>
    </div>
</div>
<!--
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-1091049-6', 'auto');
    ga('send', 'pageview');
</script>
-->
<script src="/assets/js/quotes.js" type="text/javascript"></script>
<script src="/assets/js/local.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
<script type="text/javascript" src="/assets/js/copy.js"></script>
</body>
</html>
