<!DOCTYPE html>
<html>
<head>
    <title>Coming Up for Air : Reintroducing the JSFTemplating FileStreamer</title>

    <script src="/assets/js/simple-jekyll-search.min.js" type="text/javascript"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3GQK1YDRQM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-3GQK1YDRQM');
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="me" href="https://mastodon.cloud/@jasondlee"/>

    <link rel="alternate" type="application/rss+xml" title="jasondl.ee RSS feed" href="/feed.xml">

    <link rel="stylesheet" href="/assets/css/main.css" />

    <!-- Web Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Cherry+Cream+Soda">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Philosopher">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css"/>

    <link rel="stylesheet" href="https://unpkg.com/primeflex@3.1.2/primeflex.css"/>
    <link rel="stylesheet" href="https://unpkg.com/primeflex/themes/saga-blue.css"/>
    <link rel="author" href="/images/profile-pic.jpg"/>
</head>
<body>
<div class="grid">
    <div class="col blogname">
        <span>
            <a href="https://jasondl.ee">Coming Up for Air</a>
        </span>
    </div>
</div>
<div class="grid main">
    <div class="col-9">
        <div id="content">
            <article class="post">
    <h1 class="title" style="border-bottom: solid 1px #47586d; margin-bottom: 0.25rem;">
        Reintroducing the JSFTemplating FileStreamer
    </h1>
    Tuesday, March 18, 2008 | <span class="share-page" style="">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer&title=Reintroducing the JSFTemplating FileStreamer" rel="nofollow" target="_blank" title="Share on LinkedIn">
      <i class="fa fa-linkedin-square"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Reintroducing the JSFTemplating FileStreamer&url=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer&via=jasondlee&related=jasondlee" rel="nofollow" target="_blank" title="Share on Twitter">
      <i class="fa fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer" rel="nofollow" target="_blank" title="Share on Facebook">
      <i class="fa fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="https://www.reddit.com/submit?url=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
      <i class="fa fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Reintroducing the JSFTemplating FileStreamer&amp;body=Reintroducing the JSFTemplating FileStreamer https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer" title="Share via Email" >
      <i class="fa fa-envelope"></i>
  </a>
</span>

    <div>
        <div class="paragraph">
<p>In a <a href="http://blogs.sun.com/paulsen/entry/streaming_content_in_jsf_with">blog entry</a> last year, Ken Paulsen gave a <a href="http://blogs.sun.com/paulsen/entry/streaming_content_in_jsf_with">short introduction</a> to the FileStreamer utility in <a href="https://jsftemplating.dev.java.net/">JSFTemplating</a>.  Since Scales is now using JSFTemplating to make the component authoring process easier, I have been able to use this facility, allowing me to deprecate some custom code.  In the process of making the migration, I&#8217;ve made changes to JSFTemplating that will be of benefit to all.  In this entry, I&#8217;d like to highlight those changes, and show you how you, too, can use this great facility.// more</p>
</div>
<div class="paragraph">
<p>Prior to my changes, JSFTemplating offered two ways to use the <code>FileStreamer</code>.  One way is as a <code>Servlet</code>.  This approach is intended for non-JSF users, though JSF users can certainly use it as well&#8201;&#8212;&#8201;many other frameworks have "resource servlets" as well.  Another method is a <code>ViewHandler</code>-based approached, the approach Ken uses in his blog entry, which can only be used if the JSFTemplating <code>ViewHandler</code> is in play.  Since I want to avoid as much external configuration as possible, and I don&#8217;t want to dictate a JSFTemplating-only approach to JSF app authoring (not that there&#8217;s anything wrong with that), I needed another method, so I created a <code>PhaseListener</code>-based approach:  <code>FileStreamerPhaseListener</code>.   Using a <code>PhaseListener</code>, we are able to process the request from inside the JSF lifecycle, giving us access to application state, etc.  For my purposes (namely, modifying the <code>FileDownload</code> component to use the <code>FileStreamer</code>), that is very important.  The <code>FileDownload</code> component currently works by stuffing a reference to itself in the HttpSession, which is then retrieved when the resource request is made, a process made difficult, though not impossible in a <code>Servlet</code>-based approach.</p>
</div>
<div class="paragraph">
<p>While the <code>PhaseListener</code> solves how to handle the incoming request, it doesn&#8217;t solve the problem of getting the data from the component.  This is where <code>FileStreamer</code> really shines.  As Ken notes in his blog, <code>FileStreamer</code> supports the idea of a <code>ContentSource</code>, which is a class that handles getting the content of a source (if you can imagine that) from an arbitrary location.  His examples show getting the resource from the file-system as well as a remote server, all through the same API.  Leveraging that capability, I added to Scales the <code>FileDownloadContentSource</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">class</span> <span style="color: #953800">FileDownloadContentSource</span> <span style="color: #cf222e">implements</span> <span style="color: #953800">ContentSource</span> <span style="color: #0550ae">{</span>
    <span style="color: #cf222e">public</span> <span style="color: #cf222e">final</span> <span style="color: #cf222e">static</span> <span style="color: #953800">String</span> <span style="color: #953800">CONTENT_SOURCE_ID</span> <span style="color: #0550ae">=</span> <span style="color: #0a3069">"fileDownloadCs"</span><span style="color: #0550ae">;</span>
    <span style="color: #cf222e">public</span> <span style="color: #953800">String</span> <span style="color: #8250df">getId</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">return</span> <span style="color: #953800">CONTENT_SOURCE_ID</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>
    <span style="color: #cf222e">public</span> <span style="color: #953800">InputStream</span> <span style="color: #8250df">getInputStream</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">)</span> <span style="color: #cf222e">throws</span> <span style="color: #953800">IOException</span> <span style="color: #0550ae">{</span>
        <span style="color: #953800">InputStream</span> <span style="color: #24292f;background-color: #f6f8fa">in</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">(</span><span style="color: #953800">InputStream</span><span style="color: #0550ae">)</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">getAttribute</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"inputStream"</span><span style="color: #0550ae">);</span>
        <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">in</span> <span style="color: #0550ae">!=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
            <span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">in</span><span style="color: #0550ae">;</span>
        <span style="color: #0550ae">}</span>
        <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">componentId</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">(</span><span style="color: #953800">String</span><span style="color: #0550ae">)</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">getAttribute</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span><span style="color: #0550ae">.</span><span style="color: #116329">FILE_PATH</span><span style="color: #0550ae">);</span>
        <span style="color: #953800">FacesContext</span> <span style="color: #24292f;background-color: #f6f8fa">fc</span> <span style="color: #0550ae">=</span> <span style="color: #953800">FacesContext</span><span style="color: #0550ae">.</span><span style="color: #116329">getCurrentInstance</span><span style="color: #0550ae">();</span>
        <span style="color: #953800">FileDownload</span> <span style="color: #24292f;background-color: #f6f8fa">comp</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">(</span><span style="color: #953800">FileDownload</span><span style="color: #0550ae">)</span> <span style="color: #24292f;background-color: #f6f8fa">fc</span><span style="color: #0550ae">.</span><span style="color: #116329">getExternalContext</span><span style="color: #0550ae">()</span>
            <span style="color: #0550ae">.</span><span style="color: #116329">getSessionMap</span><span style="color: #0550ae">().</span><span style="color: #116329">get</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"HtmlDownload-"</span> <span style="color: #0550ae">+</span> <span style="color: #24292f;background-color: #f6f8fa">componentId</span><span style="color: #0550ae">);</span>
        <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">comp</span> <span style="color: #0550ae">!=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
            <span style="color: #953800">Object</span> <span style="color: #24292f;background-color: #f6f8fa">value</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">comp</span><span style="color: #0550ae">.</span><span style="color: #116329">getData</span><span style="color: #0550ae">();</span>
            <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">value</span> <span style="color: #0550ae">!=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
                <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">mimeType</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">comp</span><span style="color: #0550ae">.</span><span style="color: #116329">getMimeType</span><span style="color: #0550ae">();</span>
                <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">setAttribute</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span><span style="color: #0550ae">.</span><span style="color: #116329">CONTENT_TYPE</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">mimeType</span><span style="color: #0550ae">);</span>
                <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #953800">FileDownload</span><span style="color: #0550ae">.</span><span style="color: #116329">METHOD_DOWNLOAD</span><span style="color: #0550ae">.</span><span style="color: #116329">equals</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">comp</span><span style="color: #0550ae">.</span><span style="color: #116329">getMethod</span><span style="color: #0550ae">()))</span> <span style="color: #0550ae">{</span>
                    <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">setAttribute</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span><span style="color: #0550ae">.</span><span style="color: #116329">CONTENT_DISPOSITION</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">comp</span><span style="color: #0550ae">.</span><span style="color: #116329">getMethod</span><span style="color: #0550ae">());</span>
                <span style="color: #0550ae">}</span> <span style="color: #cf222e">else</span> <span style="color: #0550ae">{</span>
                    <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">setAttribute</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span><span style="color: #0550ae">.</span><span style="color: #116329">CONTENT_DISPOSITION</span><span style="color: #0550ae">,</span> <span style="color: #0a3069">"inline"</span><span style="color: #0550ae">);</span>
                <span style="color: #0550ae">}</span>
                <span style="color: #cf222e">byte</span><span style="color: #0550ae">[]</span> <span style="color: #24292f;background-color: #f6f8fa">data</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">;</span>
                <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">value</span> <span style="color: #cf222e">instanceof</span> <span style="color: #cf222e">byte</span><span style="color: #0550ae">[])</span> <span style="color: #0550ae">{</span>
                    <span style="color: #24292f;background-color: #f6f8fa">in</span> <span style="color: #0550ae">=</span> <span style="color: #cf222e">new</span> <span style="color: #953800">ByteArrayInputStream</span> <span style="color: #0550ae">((</span><span style="color: #cf222e">byte</span><span style="color: #0550ae">[])</span> <span style="color: #24292f;background-color: #f6f8fa">value</span><span style="color: #0550ae">);</span>
                <span style="color: #0550ae">}</span> <span style="color: #cf222e">else</span> <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">value</span> <span style="color: #cf222e">instanceof</span> <span style="color: #953800">ByteArrayOutputStream</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
                    <span style="color: #24292f;background-color: #f6f8fa">in</span> <span style="color: #0550ae">=</span> <span style="color: #cf222e">new</span> <span style="color: #953800">ByteArrayInputStream</span> <span style="color: #0550ae">(((</span><span style="color: #953800">ByteArrayOutputStream</span><span style="color: #0550ae">)</span> <span style="color: #24292f;background-color: #f6f8fa">value</span><span style="color: #0550ae">)</span>
                        <span style="color: #0550ae">.</span><span style="color: #116329">toByteArray</span><span style="color: #0550ae">());</span> <span style="color: #6e7781">// EEEK!</span>
                <span style="color: #0550ae">}</span> <span style="color: #cf222e">else</span> <span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">value</span> <span style="color: #cf222e">instanceof</span> <span style="color: #953800">InputStream</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
                    <span style="color: #24292f;background-color: #f6f8fa">in</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">(</span><span style="color: #953800">InputStream</span><span style="color: #0550ae">)</span><span style="color: #24292f;background-color: #f6f8fa">value</span><span style="color: #0550ae">;</span>
                <span style="color: #0550ae">}</span> <span style="color: #cf222e">else</span> <span style="color: #0550ae">{</span>
                    <span style="color: #cf222e">throw</span> <span style="color: #cf222e">new</span> <span style="color: #8250df">FacesException</span><span style="color: #0550ae">(</span>
                        <span style="color: #0a3069">"HtmlDownload: an unsupported data type was found:  "</span> <span style="color: #0550ae">+</span>
                        <span style="color: #24292f;background-color: #f6f8fa">value</span><span style="color: #0550ae">.</span><span style="color: #116329">getClass</span><span style="color: #0550ae">().</span><span style="color: #116329">getName</span><span style="color: #0550ae">());</span>
                <span style="color: #0550ae">}</span>
            <span style="color: #0550ae">}</span>
        <span style="color: #0550ae">}</span>
        <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">setAttribute</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"inputStream"</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">in</span><span style="color: #0550ae">);</span>
        <span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">in</span><span style="color: #0550ae">;</span>
    <span style="color: #0550ae">}</span>
    <span style="color: #cf222e">public</span> <span style="color: #cf222e">void</span> <span style="color: #8250df">cleanUp</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
	<span style="color: #953800">InputStream</span> <span style="color: #24292f;background-color: #f6f8fa">is</span> <span style="color: #0550ae">=</span> <span style="color: #0550ae">(</span><span style="color: #953800">InputStream</span><span style="color: #0550ae">)</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">getAttribute</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"inputStream"</span><span style="color: #0550ae">);</span>
	<span style="color: #6e7781">// Close the InputStream</span>
	<span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">is</span> <span style="color: #0550ae">!=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
	    <span style="color: #cf222e">try</span> <span style="color: #0550ae">{</span>
		<span style="color: #24292f;background-color: #f6f8fa">is</span><span style="color: #0550ae">.</span><span style="color: #116329">close</span><span style="color: #0550ae">();</span>
	    <span style="color: #0550ae">}</span> <span style="color: #cf222e">catch</span> <span style="color: #0550ae">(</span><span style="color: #953800">Exception</span> <span style="color: #24292f;background-color: #f6f8fa">ex</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
		<span style="color: #6e7781">// Ignore...</span>
	    <span style="color: #0550ae">}</span>
	<span style="color: #0550ae">}</span>
	<span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">.</span><span style="color: #116329">removeAttribute</span><span style="color: #0550ae">(</span><span style="color: #0a3069">"inputStream"</span><span style="color: #0550ae">);</span>
    <span style="color: #0550ae">}</span>
    <span style="color: #cf222e">public</span> <span style="color: #cf222e">long</span> <span style="color: #8250df">getLastModified</span><span style="color: #0550ae">(</span><span style="color: #953800">Context</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
        <span style="color: #cf222e">return</span> <span style="color: #0550ae">-</span><span style="color: #0550ae">1</span><span style="color: #0550ae">;</span> <span style="color: #6e7781">// We don't/can't know so make it redownload every time</span>
    <span style="color: #0550ae">}</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The really interesting part is in <code>getInputStream()</code>.  We query the request for the component ID, then look it up in the session.  If it is found, we then query the data returned to determine its type, then return an <code>InputStream</code> which the <code>PhaseListener</code> will use to stream the data to the client.  I really like this <code>ContentSource</code> approach.  It&#8217;s very simple and elegant, and, as you can see, very easy to implement.  We still have two problems remaining, though:  how do I tell JSFTemplating about this new <code>ContentSource</code>, and how do I generate a URL to access the data?</p>
</div>
<div class="paragraph">
<p>In Ken&#8217;s example, he used an <code>init-param</code> in <code>web.xml</code> to register his <code>ContentSource`s.  Again, I wasn&#8217;t too comfortable with that, as it requires more external configuration.  I want people to be able to drop this component on a page and not have to worry about configuration (though there&#8217;s still the `PhaseListener</code> registration, which I&#8217;m working on).  After some discussion with Ken, I developed, with much help from him, a mechanism by which JSFTemplating will register <code>ContentSources</code> based on a properties file.  This file, <code>META-INF/jsftempalting/fileStreamer.properties</code>, looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="linenums"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>contentSources=com.sun.mojarra.scales.util.FileDownloadContentSource
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>FileStreamer</code> constructor finds any of these files that might be in any JAR in the web application&#8217;s lib directory (<code>WEB-INF/lib</code>) and registers the <code>ContentSource`s specified in the comma-delimited list (i.e., `contentSources=org.example.contentSources.ExampleContentSource, org.example.contentSources.ProxyContentSource</code>).  For the performance sensitive, this happens only once during a web app&#8217;s lifecycle, as the <code>FileStreamer</code> reference is a singleton.  At any rate, for the curious, here&#8217;s how the files are found, a new public and static method on <code>FileUtil</code> called <code>getJarResource()</code> that can be used by any application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">static</span> <span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">Tuple</span><span style="color: #0550ae">&gt;</span> <span style="color: #8250df">getJarResources</span><span style="color: #0550ae">(</span><span style="color: #953800">FacesContext</span> <span style="color: #24292f;background-color: #f6f8fa">facesContext</span><span style="color: #0550ae">,</span> <span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">resourcePath</span><span style="color: #0550ae">,</span>
		<span style="color: #953800">String</span><span style="color: #0550ae">...</span> <span style="color: #24292f;background-color: #f6f8fa">searchPaths</span><span style="color: #0550ae">)</span> <span style="color: #cf222e">throws</span> <span style="color: #953800">IOException</span>  <span style="color: #0550ae">{</span>
	<span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">searchPaths</span> <span style="color: #0550ae">==</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
		<span style="color: #6e7781">// Use default jar search path...</span>
		<span style="color: #24292f;background-color: #f6f8fa">searchPaths</span> <span style="color: #0550ae">=</span> <span style="color: #953800">DEFAULT_SEARCH_PATH</span><span style="color: #0550ae">;</span>
	<span style="color: #0550ae">}</span>
	<span style="color: #953800">List</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">Tuple</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">entries</span> <span style="color: #0550ae">=</span> <span style="color: #cf222e">new</span> <span style="color: #953800">ArrayList</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">Tuple</span><span style="color: #0550ae">&gt;();</span>
	<span style="color: #953800">ExternalContext</span> <span style="color: #24292f;background-color: #f6f8fa">ec</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">facesContext</span><span style="color: #0550ae">.</span><span style="color: #116329">getExternalContext</span><span style="color: #0550ae">();</span>
	<span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">searchPath</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">searchPaths</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
		<span style="color: #953800">Set</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">String</span><span style="color: #0550ae">&gt;</span> <span style="color: #24292f;background-color: #f6f8fa">paths</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">ec</span><span style="color: #0550ae">.</span><span style="color: #116329">getResourcePaths</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">searchPath</span><span style="color: #0550ae">);</span>
		<span style="color: #cf222e">for</span> <span style="color: #0550ae">(</span><span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">path</span> <span style="color: #0550ae">:</span> <span style="color: #24292f;background-color: #f6f8fa">paths</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
			<span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #0a3069">"jar"</span><span style="color: #0550ae">.</span><span style="color: #116329">equalsIgnoreCase</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">path</span><span style="color: #0550ae">.</span><span style="color: #116329">substring</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">path</span><span style="color: #0550ae">.</span><span style="color: #116329">length</span><span style="color: #0550ae">()</span> <span style="color: #0550ae">-</span> <span style="color: #0550ae">3</span><span style="color: #0550ae">)))</span> <span style="color: #0550ae">{</span>
				<span style="color: #953800">JarFile</span> <span style="color: #24292f;background-color: #f6f8fa">jarFile</span> <span style="color: #0550ae">=</span> <span style="color: #cf222e">new</span> <span style="color: #953800">JarFile</span><span style="color: #0550ae">(</span><span style="color: #cf222e">new</span> <span style="color: #953800">File</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">ec</span><span style="color: #0550ae">.</span><span style="color: #116329">getResource</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">path</span><span style="color: #0550ae">).</span><span style="color: #116329">getFile</span><span style="color: #0550ae">()));</span>
				<span style="color: #953800">JarEntry</span> <span style="color: #24292f;background-color: #f6f8fa">jarEntry</span> <span style="color: #0550ae">=</span> <span style="color: #24292f;background-color: #f6f8fa">jarFile</span><span style="color: #0550ae">.</span><span style="color: #116329">getJarEntry</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">resourcePath</span><span style="color: #0550ae">);</span>
				<span style="color: #cf222e">if</span> <span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">jarEntry</span> <span style="color: #0550ae">!=</span> <span style="color: #0550ae">null</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
					<span style="color: #24292f;background-color: #f6f8fa">entries</span><span style="color: #0550ae">.</span><span style="color: #116329">add</span><span style="color: #0550ae">(</span><span style="color: #cf222e">new</span> <span style="color: #953800">Tuple</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">jarFile</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">jarEntry</span><span style="color: #0550ae">));</span>
				<span style="color: #0550ae">}</span>
			<span style="color: #0550ae">}</span>
		<span style="color: #0550ae">}</span>
	<span style="color: #0550ae">}</span>
	<span style="color: #cf222e">return</span> <span style="color: #24292f;background-color: #f6f8fa">entries</span><span style="color: #0550ae">;</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The return from this method is tuple containing the <code>JarFile</code> and <code>JarEntry</code> for the properties file, which <code>FileStreamer</code> then loops through and processes.
The only remaining issue, then, is URL creation.  The new <code>FileStreamerPhaseListener</code> has a utility method to handle that for us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span style="color: #cf222e">public</span> <span style="color: #cf222e">static</span> <span style="color: #953800">String</span> <span style="color: #8250df">createResourceUrl</span><span style="color: #0550ae">(</span><span style="color: #953800">FacesContext</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">,</span>
	<span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">contentSourceId</span><span style="color: #0550ae">,</span>
	<span style="color: #953800">String</span> <span style="color: #24292f;background-color: #f6f8fa">path</span><span style="color: #0550ae">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>contentSourceId</code> is null, the default <code>ContentSource</code> is used, which is JSFTemplating&#8217;s <code>ResourceContentSource</code>.  In Scales' case, though, we want to use our custom <code>ContentSource</code>, so our call to this method looks like this (from <code>FileDownloadRenderer</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span style="color: #cf222e">protected</span> <span style="color: #953800">String</span> <span style="color: #8250df">generateUri</span><span style="color: #0550ae">(</span><span style="color: #953800">FacesContext</span> <span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">,</span> <span style="color: #953800">FileDownload</span> <span style="color: #24292f;background-color: #f6f8fa">comp</span><span style="color: #0550ae">)</span> <span style="color: #0550ae">{</span>
    <span style="color: #cf222e">return</span> <span style="color: #953800">FileStreamerPhaseListener</span><span style="color: #0550ae">.</span><span style="color: #116329">createResourceUrl</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">,</span>
            <span style="color: #953800">FileDownloadContentSource</span><span style="color: #0550ae">.</span><span style="color: #116329">CONTENT_SOURCE_ID</span><span style="color: #0550ae">,</span> <span style="color: #24292f;background-color: #f6f8fa">comp</span><span style="color: #0550ae">.</span><span style="color: #116329">getClientId</span><span style="color: #0550ae">(</span><span style="color: #24292f;background-color: #f6f8fa">context</span><span style="color: #0550ae">));</span>
<span style="color: #0550ae">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That results in a URL like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #24292f;background-color: #f6f8fa"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>/mojarra-scales-demo-facelets/jsft_resource.jsf?contentSourceId=fileDownloadCs<span style="color: #f6f8fa;background-color: #82071e">&amp;</span>filename=j_id5
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The browser can request that URL, and the <code>FileStreamerPhaseListener</code> will recognize that it should process it, determine and acquire the <code>ContentSource</code>, then query that for the data, setting the mime type, etc., as it streams the data to the client.  I am also now using this exact approach, though with the default <code>ContentSource</code>, to serve up from the Scales jar file the Javascript and CSS needed for the components, demonstrating clearly, I think, the power and flexibility of this great facility.</p>
</div>
    </div>
    <footer>
        <div class="grid">
            <div class="col tags">
                
                <span class="title">tags: </span>
                
                <a href="/tag/java/">Java</a>
                <!--                <a href="https://jasondl.ee/tags/Java.html">Java</a>-->
                
                <a href="/tag/jsf/">JSF</a>
                <!--                <a href="https://jasondl.ee/tags/JSF.html">JSF</a>-->
                
                <a href="/tag/jsftemplating/">JSFTemplating</a>
                <!--                <a href="https://jasondl.ee/tags/JSFTemplating.html">JSFTemplating</a>-->
                
                <a href="/tag/scales/">Scales</a>
                <!--                <a href="https://jasondl.ee/tags/Scales.html">Scales</a>-->
                
                
            </div>
            <div class="col"><span class="share-page" style="">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer&title=Reintroducing the JSFTemplating FileStreamer" rel="nofollow" target="_blank" title="Share on LinkedIn">
      <i class="fa fa-linkedin-square"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Reintroducing the JSFTemplating FileStreamer&url=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer&via=jasondlee&related=jasondlee" rel="nofollow" target="_blank" title="Share on Twitter">
      <i class="fa fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer" rel="nofollow" target="_blank" title="Share on Facebook">
      <i class="fa fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="https://www.reddit.com/submit?url=https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
      <i class="fa fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Reintroducing the JSFTemplating FileStreamer&amp;body=Reintroducing the JSFTemplating FileStreamer https://jasondl.ee/2008/reintroducing-the-jsftemplating-filestreamer" title="Share via Email" >
      <i class="fa fa-envelope"></i>
  </a>
</span>
</div>
        </div>
    </footer>
</article>

        </div>
    </div>
    <div class="col-3 widget">
        <div>
            <h3>Search</h3>
            <!-- HTML elements for search -->
            <input type="text" id="search-input" placeholder="Search blog posts.." style="width: 98%"/>
            <ul id="results-container"></ul>

            <script>
                var sjs = SimpleJekyllSearch({
                    searchInput: document.getElementById('search-input'),
                    resultsContainer: document.getElementById('results-container'),
                    json: '/search.json',
                    limit: 50
                })
            </script>
        </div>
        <div>
            <h3>Quotes</h3>
            <p id="quote">Sample quote</p>
            <p id="source">Quote source</p>
        </div>
        <div>
            <h3>About</h3>
            <p><img src="/images/profile-pic.jpg" style="float:right; object-fit: scale-down; padding-bottom: 1em;"/>My name is Jason Lee. I am a software developer living in the middle of Oklahoma. I’ve been a professional developer since 1997,
using a variety of languages, including Java, Javascript, PHP, Python, Delphi, and even a bit of C#. I currently work for Red Hat
on the WildFly/EAP team, where, among other things, I maintain integrations for some MicroProfile specs, OpenTelemetry, Micrometer,
Jakarta Faces, and Bean Validation. (Full resume <a href="resume">here</a>.
LinkedIn <a href="https://www.linkedin.com/in/jasondlee">profile</a>)</p>

<p>I am the president of the Oklahoma City JUG, and an occasional speaker at the JUG and a variety of technical conferences.</p>

<p>On the personal side, I’m active in my church, and enjoy bass guitar, running, fishing, and a variety of martial arts. I’m also
married to a beautiful woman, and have two boys, who, thankfully, look like their mother.</p>

        </div>
        <div>
            <h3>My Links</h3>
            <ul>
                
                <li>
                    <a href="/presentations" title="Presentations">
                        Presentations
                    </a>
                </li>
                
                <li>
                    <a href="/assets/resume.pdf" title="Resume/CV">
                        Resume/CV
                    </a>
                </li>
                
                <li>
                    <a href="https://linkedin.com/in/jasondlee" title="LinkedIn">
                        LinkedIn
                    </a>
                </li>
                
                <li>
                    <a href="https://twitter.com/jasondlee" title="Twitter">
                        Twitter
                    </a>
                </li>
                
                <li>
                    <a href="https://mastodon.cloud/@jasondlee" title="Mastodon">
                        Mastodon
                    </a>
                </li>
                
                <li>
                    <a href="/tag" title="Tags">
                        Tags
                    </a>
                </li>
                
            </ul>

        </div>
        <div>
            <h3>Publications</h3>
            <ul>
                <li>
                    <div class="grid">
                        <div class="col-8" style="text-weight: bold; font-size: large">
                            <div>Java 9 Programming Blueprints:</div>
                            <div>
                                <a title="My Java 9 book at Amazon" href="https://amzn.to/2FD2XAo" style="padding-left: 10px">Amazon</a>
                            </div>
                            <div>
                                <a title="My Java 9 book at Packt"
                                   href="https://www.packtpub.com/application-development/java-9-programming-blueprints"
                                   style="padding-left: 10px">Packt</a>
                            </div>
                        </div>
                            <div class="col-4">
                                <a href="https://amzn.to/2FD2XAo"><img src="/images/2017/j9pb.png" width="100"/></a>
                            </div>
                    </div>
                </li>
                
                <li>
                    <a href="https://jaxenter.com/tips-for-writing-pluggable-java-ee-applications-105281.html" title="This article discusses ways to use Java EE specs to implement a simple, yet powerful plugin system with a minimum of thrid party libraries.">
                        Tips for Writing Pluggable Java EE Applications
                    </a>
                </li>
                
                <li>
                    <a href="http://www.oracle.com/technetwork/articles/javaee/jsf-templating-137822.html" title="An article Ken Paulsen and I wrote detailing easy JSF component creation">
                        JSFTemplating and Woodstock: Component Authoring Made Easy
                    </a>
                </li>
                
                <li>
                    <a href="http://jsfcentral.com/articles/lee-03-09.html" title="Jason Lee in depth: Mojarra and Scales">
                        Jason Lee in depth: Mojarra and Scales
                    </a>
                </li>
                
                <li>
                    <a href="https://web.archive.org/web/20090301060746/http://www.theserverside.com/news/thread.tss?thread_id=49343" title="My JavaOne 2008 Wrap Up">
                        Jason Lee: Postmortem for JavaOne 2008
                    </a>
                </li>
                
                <li>
                    <a href="https://web.archive.org/web/20130621192312/https://blogs.oracle.com/stories/entry/international_environmental" title="The GlassFish Adoption Story from my time at IEC">
                        International Environmental: A Cooling Company Which Prefers Hot Software
                    </a>
                </li>
                
                <li>
                    <a href="http://www.jsfcentral.com/articles/trenches_7.html" title="This details the project that spawned a couple of the Mojarra Scales components">
                        IEC donates custom JSF component to Mojarra Scales
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
<div class="footer">
    <div>
        <p>&#169; Copyright Jason Lee, 2005-2023. All rights reserved.</p>
    </div>
</div>
<!--
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-1091049-6', 'auto');
    ga('send', 'pageview');
</script>
-->
<script src="/assets/js/quotes.js" type="text/javascript"></script>
<script src="/assets/js/local.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
<script type="text/javascript" src="/assets/js/copy.js"></script>
</body>
</html>
