---
title: 'Run GlassFish V3 As a Non-Root Service on Gentoo Linux'
author: 'Jason Lee'
layout: blog-post
date: 2010-3-4
tags: [ Gentoo, GlassFish, Linux ]
---
<p>Byron Nevins, a colleague of mine here at Oracle, has a couple of nice <a href="http://blogs.sun.com/foo/entry/how_to_run_glassfish_v3">blog</a> <a href="http://blogs.sun.com/foo/entry/run_glassfish_v3_as_a">entries</a> showing how to run GlassFish as a service, both as root and non-root users, on Ubuntu or Debian.  As a Gentoo user, that doesn't help me much, unfortunately, but, some time ago, I developed a script that works great for me, so I thought I'd share it here.
pass::[more]
</p>
<p>To make things a bit easier, go read Byron's non-root user entry (changing the install location to /opt/glassfish unless you want to edit the script below), and stop at step 5.  I'll wait.
</p>
<p>All done there?  Ok, great!<sup><a href="#1">1</a></sup>  
</p>
<p>As the root user (or a user with appropriate privileges), create the file <code>/etc/init.d/glassfish</code> and paste the following script into it:
</p>
<p>[source]
</p>
<p>#!/sbin/runscript
</p>
<p>depend() {
</p>
<p>        need net
</p>
<p>}
</p>
<p>start() {
</p>
<p>        ebegin "Starting glassfish"
</p>
<p>        # Ensure that we run from a readable working dir, and that we do not
</p>
<p>        # lock filesystems when being run from such a location.
</p>
<p>        cd /
</p>
<p>        start-stop-daemon --start --quiet --background --make-pidfile --pidfile /var/run/glassfish.pid --exec /usr/local/bin/gf_start
</p>
<p>        eend $?
</p>
<p>}
</p>
<p>stop() {
</p>
<p>        ebegin "Stopping glassfish"
</p>
<p>        /usr/local/bin/gf_stop
</p>
<p>        eend $?
</p>
<p>}
</p>
<p>restart() {
</p>
<p>        if ! service_stopped "${SVCNAME}" ; then
</p>
<p>                svc_stop || return "$?"
</p>
<p>        fi
</p>
<p>        svc_start
</p>
<p>}
</p>
<p>[/source]
</p>
<p>I actually use a couple of scripts, as you might see there, to help manage my GlassFish instance, as I run this on my "dev" box.  Those two scripts are <code>/usr/local/bin/gf_start</code>:
</p>
<p>[source]
</p>
<p>#!/bin/bash
</p>
<p>su -c '/opt/glassfish/server/bin/asadmin start-domain' glassfish
</p>
<p>[/source]
</p>
<p>and <code>/usr/local/bin/gf_stop</code>:
</p>
<p>[source]
</p>
<p>#!/bin/bash
</p>
<p>su -c '/opt/glassfish/server/bin/asadmin stop-domain' glassfish
</p>
<p>[/source]
</p>
<p>Once those files are in place (and paths are updated), test the script (<code>/etc/init.d.glassfish start</code>) to make sure everything is working as expected.  Once you're happy with it, you can register the service to start at system boot by issuing the command <code>rc-update add glassfish default</code>.  The next time your system starts, GlasssFish will be patiently waiting for you on port 8080.
</p>
<p>If you'd like, you can now issue the iptables commands that Bryon lists to redirect port 80 to 8080. I haven't done that because I actually front GlassFish with Apache as I have other sites listening on 80 and uses virtual hosts to sort them all out, but that's another topic altogether. :)
</p>
<p>I hope that helps.
</p>
<hr/>
<a name="1"></a><sup>1</sup>  My apologies to my fellow Sun employees. I couldn't help myself. ;)
