---
title: 'Adding SCM Branch Information to Your Prompt'
author: 'Jason Lee'
layout: blog-post
date: 2010-10-25
tags: [ bash, cvs, General, git, hg, prompt, scm, svn ]
---
<strong>UPDATE: I've modified the scripts and prompt settings to be a bit more intelligent</strong>
<p>Today, a coworker sent me a link to an old <a href="http://hocuspokus.net/2009/07/add-git-and-svn-branch-to-bash-prompt">blog post</a> about adding git and svn branch information to your prompt.  As awesome and helpful as that was, my first thought was, "What about hg support?" followed quickly, if not somewhat embarrassingly, by, "What about CVS support?"  Thinking it would be quicker (and more fun) to hack than to google, I added both.  The end result is this:
</p>
pass::[more]
<p>[bash]
</p>
<p>parse_git_branch () {
</p>
<p>    git name-rev HEAD 2> /dev/null | sed 's#HEAD\ \(.*\)# (git::\1)#'
</p>
<p>}
</p>
<p>parse_hg_branch() {
</p>
<p>    hg branch 2>/dev/null | sed 's#\(.*\)# (hg::\1)#'
</p>
<p>}
</p>
<p>parse_svn_branch() {
</p>
<p>    parse_svn_url | sed -e 's#^'"$(parse_svn_repository_root)"'##g' | awk '{print " (svn::"$1")" }'
</p>
<p>}
</p>
<p>parse_svn_url() {
</p>
<p>    if [ -e .svn ] ; then
</p>
<p>        svn info 2>/dev/null | sed -ne 's#^URL: ##p' | sed -e 's#^'"$(parse_svn_repository_root)"'##g' | egrep -o '(tags|branches)/[^/]+|trunk' | egrep -o '[^/]+$' | awk '{print " ("$1")" }'
</p>
<p>    fi
</p>
<p>}
</p>
<p>parse_svn_repository_root() {
</p>
<p>    if [ -e .svn ] ; then
</p>
<p>        svn info 2>/dev/null | sed -ne 's#^Repository Root: ##p'
</p>
<p>    fi
</p>
<p>}
</p>
<p>parse_cvs_branch() {
</p>
<p>    if [ -e CVS ] ; then
</p>
<p>        #cat CVS/TAG | cut -c 2- 2>/dev/null | sed '#\(.*\)# (cvs::\1)#'
</p>
<p>        BRANCH=`cat CVS/TAG 2>/dev/null | cut -c 2- ` ; if [ "$BRANCH" != "" ] ; then echo " (cvs::$BRANCH)" ; fi
</p>
<p>    fi
</p>
<p>}
</p>
<p>get_branch_information() {
</p>
<p>    if [ -e .svn ] ; then
</p>
<p>        parse_svn_branch
</p>
<p>    elif [ -e CVS ] ; then
</p>
<p>        parse_cvs_branch
</p>
<p>    else
</p>
<p>        parse_git_branch
</p>
<p>        parse_hg_branch
</p>
<p>    fi
</p>
<p>}
</p>
<p>BLACK="\[\033[0;38m\]"
</p>
<p>RED="\[\033[0;31m\]"
</p>
<p>RED_BOLD="\[\033[01;31m\]"
</p>
<p>BLUE="\[\033[01;34m\]"
</p>
<p>GREEN="\[\033[0;32m\]"
</p>
<p>export PS1="$BLACK[ \u@$RED\h $GREEN\w$RED_BOLD\$(get_branch_information)$BLACK ] "
</p>
<p>[/bash]
</p>
<strike>There's a good chance it could be improved, especially the CVS part (for example, all of those functions could be condensed to one that does much cheaper "if exists" tests before executing the commands) but it works well enough that I'm happy to move on.</strike>  I should note that there seems to be a slight performance hit due to all of this, but I can't tell if it's all these new checks or if my machine is just already working too hard.  Either way, it's nowhere near significant enough to make me care. :)
