---
title: 'Mojarra Scales Gets a Z-Order Update'
author: 'Jason Lee'
layout: blog-post
date: 2009-1-16
tags: [ Java, JavaServer Faces, jsf, mojarra scales, Scales ]
---
<p>As I noted in a recent <a href='http://blogs.steeplesoft.com/changes-are-coming-to-the-glassfish-admin-console/' target='_blank'>entry</a>, we are considering moving to a desktop-like interface for the GlassFish Administration Console, where the content is in separate "windows" (decorated DIVs, basically) which can be moved, closed, minimized, etc.  As I've started working on a concrete implementation of some of those ideas, I quickly realized that we were going to have issues with multiple, overlapping windows.  Once you have multiple windows open, the user has to be able to bring the desired window to the front, but YUI, which will likely be the library used, doesn't support that natively.  Fortunately, that's easy to fix.  First, an example of the problem:
</p>
<p>[caption id="attachment_219" align="alignright" width="385" caption="Overlapping window example"]<a href='http://blogs.steeplesoft.com/wp-content/uploads/2009/01/window_example.png'><img alt='Overlapping window example' class='size-full wp-image-219' height='300' src='http://blogs.steeplesoft.com/wp-content/uploads/2009/01/window_example.png' title='Overlapping window example' width='385'/></a>[/caption]
</p>
<p>With stock YUI, as best as I can tell, if you want to look at Window #2, you're out luck.  With this simple JS, though, the problem is quickly solved:
</p>
<p>[source lang="javascript"]
</p>
<p>    var currentMaxZ = 1;
</p>
<p>    registerPanel = function(id, panel) {
</p>
<p>        scalesPanels[id] = panel;
</p>
<p>        YAHOO.util.Event.addListener(id, "mousedown", bringToFront);
</p>
<p>        currentMaxZ++;
</p>
<p>    }
</p>
<p>    setZToMax = function (target) {
</p>
<p>        YAHOO.util.Dom.setStyle(target, 'z-index', ++currentMaxZ);
</p>
<p>    }
</p>
<p>    bringToFront = function (event) {
</p>
<p>        setZToMax(event.target.parentNode.parentNode);
</p>
<p>    }[/source]
</p>
<p>There may be more elegant approaches, but here's how this one works.  When the page first loads, the variable <code>currentMaxZ</code> is set to one.  As each windows is registered (a requirement I put on the page), the variable is incremented, and an "onclick" handler is attached to the DOM element.  Now, when someone clicks on the panel/window/dialog, whether it's a simple click or a click to drag, <code>bringToFront</code> is called, which determines the actual DOM element that needs to be manipulated (due to how YUI works, the DOM isn't as simple as it may look in your markup), then delegates to <code>setZToMax</code> (it's a separate function so that other parts of Scales can reuse the functionality) which increments <code>currentMaxZ</code> and sets the target's <code>z-index</code> style property to that value.  Once that's done, the window is brought to front, as expected.  
</p>
<p>Having worked out how to do that, I've added this functionality to Scales (which will likely be used in the GlassFish console, if only just for this exploration) and committed that to the repository (about which I need to post, but that will have to wait a bit longer).   If you'd like to see this in action, point your browser <a href='http://www.jsftemplating.org/mojarra-scales-demo/facelets/panel.xhtml' target='_blank'>here</a> (there is, at the moment, an odd rendering bug I'm trying to track down) and let me know what you think.
</p>
<p>[tags]jsf, mojarra scales[/tags]</p>
