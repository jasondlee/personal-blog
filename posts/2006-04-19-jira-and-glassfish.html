---
title: 'JIRA and Glassfish'
author: 'Jason Lee'
layout: blog-post
date: 2006-4-19
tags: [ Java ]
---
<p>Officially, <a target="_blank" href="https://glassfish.dev.java.net/">Glassfish</a> is not a supported platform for <a target="_blank" href="http://atlassian.com/software/jira/">JIRA</a>, Atlassian's extremly popular issue tracker.  Since we're migrating to Glassfish at <a title="Please don't blame IT for that site" target="_blank" href="http://www.iec-okc.com">work</a>, it's pretty important that we get it the two to work together.  As it turns out, it's really not that bad at all.  Here's what I had to do to get JIRA, <a target="_blank" href="http://www.postgresql.org">PostgreSQL</a>, <a title="Sometimes, you do what you gotta do..." target="_blank" href="http://www.microsoft.com/windowsserver2003/technologies/activedirectory/default.mspx">Active Directory</a> and Glassfish all playing nicely together.
</p>
pass::[more]
The first step, of course, is to download the JIRA distribution (For our purpose here, I'm going to assume that Glassfish and PostgreSQL are already installed an running.)  Once JIRA has been downloaded, we need to extract the archive to our work area and make our mods.  In our case, the mods were pretty simple:  database location, plus Active Directory integration, which means two files need to be modified.
<p>For the database, you'll need to modify entityengine.xml, which you will want to copy from webapp/WEB-INF/classes to edit-webapp/WEB-INF/classes.  We'll need to make two changes in this file:  the transaction factory, and the data source.  For the transaction factory, we need to locate the element, and edit it to look like this:
</p>
<p>[source lang="xml"]
</p>
<transaction-factory class="org.ofbiz.core.entity.transaction.JNDIFactory">
    <user-transaction-jndi jndi-server-name="default" jndi-name="UserTransaction"/>
    <transaction-manager-jndi jndi-server-name="default" jndi-name="UserTransaction"/>
</transaction-factory>
<p>[/source]
</p>
<p>For the curious, that change is just the removal of "java:comp/" from the JNDI name.  For the data source, find the  element toward the end of the file.  This is what ours looks like:
</p>
<p>[source lang="xml"]<datasource name="defaultDS" field-type-name="postgres72"
</p>
<p>	helper-class="org.ofbiz.core.entity.GenericHelperDAO"
</p>
<p>	check-on-start="true"
</p>
<p>	use-foreign-keys="true"
</p>
<p>	use-foreign-key-indices="true"
</p>
<p>	check-fks-on-start="true"
</p>
<p>	check-fk-indices-on-start="true"
</p>
<p>	add-missing-on-start="true"
</p>
<p>	check-indices-on-start="true">
</p>
	<jndi-jdbc jndi-server-name="default" jndi-name="jdbc/Jira"/>
</datasource>[/source]
<p>Of course, you need to make sure that the datasource "jdbc/Jira" is configured in Glassfish.  If you need help with that, <a title="Glassfish and PostgreSQL" target="_blank" href="http://blogs.sun.com/roller/page/Glassfish_PostgreSQL?entry=introducing_support_for_postgresql_in">this</a> blog entry should be helpful. For Active Directory integration, copy osuser.xml from webapp/WEB-INF/classes to edit-webapp/WEB-INF/classes.  Since this file is smaller, I'll show it in its entirety:
</p>
<p>[source lang="xml"]<opensymphony-user>
</p>
	<authenticator 
<p>		class="com.opensymphony.user.authenticator.SmartAuthenticator"/>
</p>
	<provider 
<p>		class="com.opensymphony.user.provider.ldap.LDAPCredentialsProvider">
</p>
		<property name="java.naming.factory.initial">
<p>			com.sun.jndi.ldap.LdapCtxFactory
</p>
		</property>
		<property name="java.naming.provider.url">
<p>			ldap://foo:389
</p>
		</property>
		<property name="searchBase">
<p>			cn=Users,dc=foo
</p>
		</property>
		<property name="uidSearchName">
<p>			sAMAccountName
</p>
		</property>
		<property name="java.naming.security.principal">
<p>			cn=ESP Service Account,cn=Users,dc=foo
</p>
		</property>
		<property name="java.naming.security.credentials">
<p>			bar
</p>
		</property>
		<property name="exclusive-access">
<p>			true
</p>
		</property>
	</provider>
	<provider 
<p>		class="com.atlassian.core.ofbiz.osuser.CoreOFBizCredentialsProvider">
</p>
		<property name="exclusive-access">true</property>
	</provider>
	<provider 
<p>		class="com.opensymphony.user.provider.ofbiz.OFBizProfileProvider">
</p>
		<property name="exclusive-access">true</property>
	</provider>
	<provider 
<p>		class="com.opensymphony.user.provider.ofbiz.OFBizAccessProvider">
</p>
		<property name="exclusive-access">true</property>
	</provider>
</opensymphony-user>[/source]
<p>Once those files have been created, from the root of the JIRA work directory, issue the command "build ear".  Technically, you have a choice between WAR and EAR deployment.  I chose EAR, as it saves me one step (changing the context root) at deployment.  It will most likely take a few minutes for that task to complete.  Once it has, log on to the Glassfish <a title="Glassfish Administration Console" target="_blank" href="http://localhost:4848">admin app</a>, navigate to Applications->Enterprise Applications, click deploy, then click Browse to find your EAR, which will be in the directory dist-generic in your JIRA working directory.  Select the ear, click OK, click Next, change the app name if you'd like, then click Finish.  This process, too, will likely take a few minutes, but, once it's done, you're ready to point your browser at your <a title="Your new JIRA installation" target="_blank" href="http://localhost:8080/jira">new JIRA installation</a> and begin configuring it.It's that easy! ;)</p>
