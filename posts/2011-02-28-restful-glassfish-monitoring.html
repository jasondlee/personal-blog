---
title: 'RESTful GlassFish Monitoring'
author: 'Jason Lee'
layout: blog-post
date: 2011-2-28
tags: [ GlassFish, Java, monitoring, REST ]
---
<p>In previous posts, I've shown various ways to manage a GlassFish 3.1 server via its REST interface.  As nice as that is, we also support monitoring your server via REST as well.  In this article, we'll take a look at some of the things you can ask of your server.<!--more-->
</p>
<p>If you're familiar with the management interface, you should be immediately comfortable with the monitoring interface.  To access it, you use <a href='http://localhost:4848/monitoring/domain'>http://localhost:4848/monitoring/domain</a>.  Just like the management interface, you can request HTML, XML, or JSON.  The simplest way to change the return type is to append an extension of the desired type.
</p>
<p>[code]
</p>
<p>$ curl http://localhost:4848/monitoring/domain.html
</p>
<p>$ curl http://localhost:4848/monitoring/domain.xml
</p>
<p>$ curl http://localhost:4848/monitoring/domain.json
</p>
<p>[/code]
</p>
<p>Similarly, you can use the <code>Accept</code> header as well:
</p>
<p>[code]
</p>
<p>$ curl -H "Accept: text/html" http://localhost:4848/monitoring/domain
</p>
<p>$ curl -H "Accept: application/xml" http://localhost:4848/monitoring/domain
</p>
<p>$ curl -H "Accept: application/json" http://localhost:4848/monitoring/domain
</p>
<p>[/code]
</p>
<p>There's a good chance that at this point, many of you are getting a response that looks like this (in JSON):
</p>
<p>[js]
</p>
<p>{
</p>
<p>    "message": "",
</p>
<p>    "command": "Monitoring Data",
</p>
<p>    "exit_code": "SUCCESS"
</p>
<p>}
</p>
<p>[/js]
</p>
<p>I'll admit that's not a very helpful message, but the issue here is that while monitoring is turned on by default, the monitoring levels are set to <code>OFF</code> by default.  You can change that a few different ways.  Perhaps the two easiest are via the command-line (you can use <code>asadmin set</code>, but we'll not look at that here):
</p>
<p>[code]
</p>
<p>$ asadmin enable-monitoring --modules web-container=LOW:ejb-container=HIGH
</p>
<p>[/code]
</p>
<p>or via the Admin Console:
</p>
<a href='http://blogs.steeplesoft.com/wp-content/uploads/2011/02/monitoringpage.png'><img alt='' class='aligncenter size-medium wp-image-910' src='http://blogs.steeplesoft.com/wp-content/uploads/2011/02/monitoringpage.png' title='monitoringpage' width='700'/></a>
<p>Select the modules you're interested in (if you're just experimenting, it might be best to select all of them), select the level you want (again, I'd suggest <code>HIGH</code> for now), then click save.  Your monitoring requests will now give you the data you're seeking.
</p>
<p>Now that we know <em>how</em> to get the data, what <em>kind</em> of data can get?  Fortunately, the system will help you with that:
</p>
<p>[code]
</p>
<p>$ curl -H "Accept: application/json" http://localhost:4848/monitoring/domain
</p>
<p>{
</p>
<p>    "message": "",
</p>
<p>    "command": "Monitoring Data",
</p>
<p>    "exit_code": "SUCCESS",
</p>
<p>    "extraProperties": {
</p>
<p>        "entity": {},
</p>
<p>        "childResources": {"server": "http:\/\/localhost:4848\/monitoring\/domain\/server"}
</p>
<p>    }
</p>
<p>}
</p>
<p>[/code]
</p>
<p>If you just installed GlassFish 3.1, you'll see the above.  If, however, you have a more complex setup (cluster, standalone instances, etc.), you might see something like this (two clustered instances, one standalone instance,  and the DAS):
</p>
<p>[code]
</p>
<p>$ curl -H "Accept: application/json" http://localhost:4848/monitoring/domain
</p>
<p>{
</p>
<p>    "message": "",
</p>
<p>    "command": "Monitoring Data",
</p>
<p>    "exit_code": "SUCCESS",
</p>
<p>    "extraProperties": {
</p>
<p>        "entity": {},
</p>
<p>        "childResources": {
</p>
<p>            "c1in1": "http:\/\/localhost:4848\/monitoring\/domain\/c1in1",
</p>
<p>            "c1in2": "http:\/\/localhost:4848\/monitoring\/domain\/c1in2",
</p>
<p>            "in1": "http:\/\/localhost:4848\/monitoring\/domain\/in1",
</p>
<p>            "server": "http:\/\/localhost:4848\/monitoring\/domain\/server"
</p>
<p>        }
</p>
<p>    }
</p>
<p>}[/code]
</p>
<p>If you do have extra instances like this, you will need to set the monitoring levels as desired in the appropriate configuration.
</p>
<p>The <code>server</code> instance (also known as the DAS), has these child elements:
</p>
<p>[code]
</p>
<p>$ curl -H "Accept: application/json" http://localhost:4848/monitoring/domain/server
</p>
<p>{
</p>
<p>    "message": "",
</p>
<p>    "command": "Monitoring Data",
</p>
<p>    "exit_code": "SUCCESS",
</p>
<p>    "extraProperties": {
</p>
<p>        "entity": {
</p>
<p>            "starttime": "1298837779434",
</p>
<p>            "state": "1",
</p>
<p>            "uptime": "2639132"
</p>
<p>        },
</p>
<p>        "childResources": {
</p>
<p>            "applications": "http:\/\/localhost:4848\/monitoring\/domain\/server\/applications",
</p>
<p>            "deployment": "http:\/\/localhost:4848\/monitoring\/domain\/server\/deployment",
</p>
<p>            "http-service": "http:\/\/localhost:4848\/monitoring\/domain\/server\/http-service",
</p>
<p>            "jvm": "http:\/\/localhost:4848\/monitoring\/domain\/server\/jvm",
</p>
<p>            "network": "http:\/\/localhost:4848\/monitoring\/domain\/server\/network",
</p>
<p>            "resources": "http:\/\/localhost:4848\/monitoring\/domain\/server\/resources",
</p>
<p>            "security": "http:\/\/localhost:4848\/monitoring\/domain\/server\/security",
</p>
<p>            "transaction-service": "http:\/\/localhost:4848\/monitoring\/domain\/server\/transaction-service",
</p>
<p>            "web": "http:\/\/localhost:4848\/monitoring\/domain\/server\/web"
</p>
<p>        }
</p>
<p>    }
</p>
<p>}[/code]
</p>
<p>Note that we can see the server start time (displayed in Unix time. This server was started on Sun Feb 27 2011 14:16:19 GMT-0600 (CST)) and how long the server has been up (2639132 milliseconds, or about 44 minutes).  Notice under <code>childResources</code> the various classes of additional information.  The easiest way to examine those is to point your browser at <a href='http://localhost:4848/monitoring/domain/server'>http://localhost:4848/monitoring/domain/server</a>.  Go ahead and poke around. You can't hurt anything. : )
</p>
<p>While I won't take the time to examine the tree exhaustively, for those that can't examine a running GlassFish instance right now, let's take a look at the information on memory the server gives us:
</p>
<p>[code]
</p>
<p>curl -H "Accept: application/json" http://localhost:4848/monitoring/domain/server/jvm/memory
</p>
<p>{
</p>
<p>    "message": "",
</p>
<p>    "command": "Monitoring Data",
</p>
<p>    "exit_code": "SUCCESS",
</p>
<p>    "extraProperties": {
</p>
<p>        "entity": {
</p>
<p>            "committedheapsize-count": {
</p>
<p>                "count": 158642176,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Amount of memory in bytes that is committed for the Java virtual machine to use",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "CommittedHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "committednonheapsize-count": {
</p>
<p>                "count": 120938496,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Amount of memory in bytes that is committed for the Java virtual machine to use",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "CommittedNonHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "initheapsize-count": {
</p>
<p>                "count": 0,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Amount of memory in bytes that the Java virtual machine initially requests from the operating system for memory management",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "InitialHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "initnonheapsize-count": {
</p>
<p>                "count": 12750848,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Amount of memory in bytes that the Java virtual machine initially requests from the operating system for memory management",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "InitialNonHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "maxheapsize-count": {
</p>
<p>                "count": 518979584,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Maximum amount of memory in bytes that can be used for memory management",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "MaxHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "maxnonheapsize-count": {
</p>
<p>                "count": 234881024,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Maximum amount of memory in bytes that can be used for memory management",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "MaxNonHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "objectpendingfinalizationcount-count": {
</p>
<p>                "count": 0,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Approximate number of objects for which finalization is pending",
</p>
<p>                "unit": "count",
</p>
<p>                "name": "ObjectsPendingFinalization",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "usedheapsize-count": {
</p>
<p>                "count": 95092688,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Amount of used memory in bytes",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "UsedHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            },
</p>
<p>            "usednonheapsize-count": {
</p>
<p>                "count": 77427208,
</p>
<p>                "lastsampletime": 1298841382830,
</p>
<p>                "description": "Amount of used memory in bytes",
</p>
<p>                "unit": "bytes",
</p>
<p>                "name": "UsedNonHeapSize",
</p>
<p>                "starttime": 1298839382803
</p>
<p>            }
</p>
<p>        },
</p>
<p>        "childResources": {}
</p>
<p>    }
</p>
<p>}[/code]
</p>
<p>In English, this shows us:
</p>
<ul>
<li>CommittedHeapSize - 158642176 bytes</li>
<li>CommittedNonHeapSize - 120938496 bytes</li>
<li>InitialHeapSize - 0 bytes</li>
<li>InitialNonHeapSize - 12750848 bytes</li>
<li>MaxHeapSize - 518979584 bytes</li>
<li>MaxNonHeapSize - 234881024 bytes</li>
<li>ObjectsPendingFinalization - 0</li>
<li>UsedHeapSize - 95092688 bytes</li>
<li>UsedNonHeapSize - 77427208 bytes</li>
</ul>
<p>Similarly, from <a href='http://localhost:4848/monitoring/domain/server/jvm/runtime'>http://localhost:4848/monitoring/domain/server/jvm/runtime</a>, we learn (large strings like <code>InputArguments</code> stripped for brevity's sake):
</p>
<ul>
<li>ClassPath</li>
<li>InputArguments</li>
<li>LibraryPath</li>
<li>ManagementSpecVersion - 1.2</li>
<li>Name - 937@halpert</li>
<li>SpecName - Java Virtual Machine Specification</li>
<li>SpecVendor - Sun Microsystems Inc.</li>
<li>SpecVersion - 1.0</li>
<li>Uptime - 1298843595776</li>
<li>VmName - Java HotSpot(TM) Client VM</li>
<li>VMVendor - Apple Inc.</li>
<li>VmVersion - 17.1-b03-307</li>
</ul>
<p>We've only scratched the surface of what the monitoring interface can provide developers and administrators, and since this is REST, you no longer need to write a Java client to get to the data, so point your browser at the monitoring interface and start digging.</p>
